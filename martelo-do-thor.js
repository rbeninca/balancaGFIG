const A=a=>a==void 0;let _={playerName:'',currentAttempt:1,maxAttempts:3,forceMaxPerAttempt:[0,0,0],attempts:[],totalMaxForce:0,isGameRunning:!1,countdownActive:!1,forceDataPerAttempt:[[],[],[]],continuousForceData:[],continuousForcePathCache:null,continuousForcePathCacheVersion:0,forcePathCachePerAttempt:[null,null,null],forcePathCacheVersionPerAttempt:[0,0,0]},c={},d=null,B={},F={},g=10000,h=3000,I=null,j=null,k=null,P=!1,q=null,aE=0,aF=1000/60;document.addEventListener('DOMContentLoaded',()=>{m();n();l();aN();s('start');r();bD();aG();console.log('âœ“ Martelo do Thor carregado')});async function l(){try{let C=await fetch('frases.json');d=await C.json();console.log('âœ“ Frases de deboche carregadas com sucesso!')}catch(e){console.error('Erro ao carregar frases.json:',e)}}function m(){c.gameContainer=document.getElementById('gameContainer');c.gameContainer.backgroundColor='#FFFFFF';c.screens={start:document.getElementById('start-screen'),game:document.getElementById('game-screen'),results:document.getElementById('results-screen'),ranking:document.getElementById('ranking-screen'),settings:document.getElementById('settings-screen')};c.playerNameInput=document.getElementById('playerName');c.playerNameResult=document.getElementById('playerNameResult');c.startButton=document.getElementById('startButton');c.countdown=document.getElementById('countdown');c.currentPlayer=document.getElementById('currentPlayer');c.forceDisplay=document.getElementById('forceDisplay');c.newtonDisplay=document.getElementById('newtonDisplay');c.progressBar=document.getElementById('progressBar');c.verticalForceBar=document.getElementById('vertical-force-bar');c.forceMarkerCurrent=document.getElementById('force-marker-current');c.forceMarkerMax=document.getElementById('force-marker-max');c.labelForceCurrent=document.getElementById('label-force-current');c.labelForceMax=document.getElementById('label-force-max');c.resultForce=document.getElementById('resultForce');c.motivationalMessage=document.getElementById('motivationalMessage');c.playAgainButton=document.getElementById('playAgainButton');c.showRankingButton=document.getElementById('showRankingButton');c.rankingTableBody=document.querySelector('#rankingTable tbody');c.backToStartButton=document.getElementById('backToStartButton');c.clearRankingButton=document.getElementById('clearRankingButton');c.settingsButton=document.getElementById('settingsButton');c.settingsScreen=document.getElementById('settings-screen');c.maxForceInput=document.getElementById('maxForceInput');c.thresholdFraca=document.getElementById('threshold-fraca');c.thresholdMedia=document.getElementById('threshold-media');c.thresholdAlta=document.getElementById('threshold-alta');c.thresholdMuitoAlta=document.getElementById('threshold-muito_alta');c.thresholdEpica=document.getElementById('threshold-epica');c.saveSettingsButton=document.getElementById('saveSettingsButton');c.dynamicMaxForceCheckbox=document.getElementById('dynamicMaxForceCheckbox');c.rankingMarkers={marker1:document.getElementById('rank-marker-1'),marker2:document.getElementById('rank-marker-2'),marker3:document.getElementById('rank-marker-3')};c.forceGraphCanvas=document.getElementById('forceGraphCanvas');c.attemptMessage=document.getElementById('attempt-message');c.modalNovoRecorde=document.getElementById('modal-novo-recorde');c.modalRecordeMensagem=document.getElementById('modal-recorde-mensagem');c.modalRecordeSuaForca=document.getElementById('modal-recorde-sua-forca');c.modalRecordeAnterior=document.getElementById('modal-recorde-anterior');c.modalSobrecarga=document.getElementById('modal-alerta-sobrecarga-martelo');c.modalSobrecargaTitulo=document.getElementById('modal-sobrecarga-titulo-martelo');c.modalSobrecargaMensagem=document.getElementById('modal-sobrecarga-mensagem-martelo');c.modalSobrecargaValorAtual=document.getElementById('modal-sobrecarga-valor-atual-martelo');c.modalSobrecargaBarraProgresso=document.getElementById('modal-sobrecarga-barra-progresso-martelo');c.modalSobrecargaPercentual=document.getElementById('modal-sobrecarga-percentual-martelo');c.modalSobrecargaValorLimite=document.getElementById('modal-sobrecarga-valor-limite-martelo');F.countdown=document.getElementById('sound-countdown');F.go=document.getElementById('sound-go');F.level1=document.getElementById('sound-level-1');F.level2=document.getElementById('sound-level-2');F.level3=document.getElementById('sound-level-3');F.level4=document.getElementById('sound-level-4');F.level5=document.getElementById('sound-level-5');F.level6=document.getElementById('sound-level-6');F.result=document.getElementById('sound-result');F.newRecord=new Audio('sounds/new_record.mp3')}function n(){c.startButton.addEventListener('click',T);c.playAgainButton.addEventListener('click',()=>{clearTimeout(j);bC()});c.showRankingButton.addEventListener('click',()=>{clearTimeout(j);aS()});c.playerNameResult.addEventListener('input',()=>{aR(c.playerNameResult.value);aL()});c.backToStartButton.addEventListener('click',()=>s('start'));c.clearRankingButton.addEventListener('click',aU);c.settingsButton.addEventListener('click',aP);c.saveSettingsButton.addEventListener('click',aO);c.dynamicMaxForceCheckbox.addEventListener('change',e=>{if(e.target.checked){c.maxForceInput.disabled=!0;let _a=JSON.parse(localStorage.getItem('martelo_ranking')||'[]'),_b=300;_a.length>0&&(_b=Math.ceil(_a[0].forceKg/10)*10);c.maxForceInput.value=_b}else c.maxForceInput.disabled=!1});document.addEventListener('keydown',e=>{(e.key==='d'||e.key==='D')&&bF()})}let o=0;function r(){try{if(window.opener?.sharedState&&window.opener.sharedState.forcaAtual!==void 0){console.log('âœ“ Acesso ao window.opener.sharedState.forcaAtual disponÃ­vel!');P=!0}else window.opener?(console.warn('âš ï¸ window.opener encontrado mas forcaAtual nÃ£o estÃ¡ definido'),q='forcaAtual nÃ£o disponÃ­vel na janela pai'):(console.warn('âš ï¸ window.opener Ã© null - pÃ¡gina pode ter sido aberta em fullscreen'),q='window.opener indisponÃ­vel')}catch(e){console.error('âŒ Erro ao acessar window.opener:',e.message);q=e.message}let D=setInterval(()=>{try{if(window.opener?.sharedState){if(typeof window.opener.sharedState.forcaAtual==='number'){o=window.opener.sharedState.forcaAtual;P=!0;q=null;if(!_.isGameRunning){let E=o/9.80665;X(E);_.continuousForceData.push({force:E});_.continuousForceData.length>834&&_.continuousForceData.shift()}}let _A=window.opener.sharedState.overloadAlert;_A?.active?(c.modalSobrecarga.classList.add('ativo'),bA(_A)):(c.modalSobrecarga.classList.remove('ativo'))}}catch(e){!q&&(console.warn('Erro recorrente ao acessar sharedState:',e.message),q=e.message)}},12);setTimeout(()=>console.log(`[POLLING] Status: ${P?'âœ“ ATIVO':'âœ— INATIVO'} | Valor: ${o} N | Erro: ${q||'nenhum'}`),1000)}function s(bG){for(const bH of Object.values(c.screens))bH.classList.remove('active');c.screens[bG].classList.add('active')}function T(){aN();let bI=c.playerNameInput.value.trim();if(!bI){alert('Digite seu nome, Viking! âš¡');return}_.playerName=bI;_.currentAttempt=1;_.forceMaxPerAttempt=[0,0,0];_.totalMaxForce=0;_.forceDataPerAttempt=[[],[],[]];aV();s('game');u()}async function u(){_.countdownActive=!0;c.countdown.innerHTML='';let bJ=[3,2,1];for(const bK of bJ){c.countdown.innerHTML=`
      <div class="countdown-number" style="
        animation: countdown-cinema 1s ease-out;
        font-size: 20rem;
        font-weight: 900;
        text-shadow: 0 0 40px ${Y(100)}, 0 0 80px ${Y(100)};
      ">${bK}</div>
    `;if(F.countdown)try{F.countdown.currentTime=0;F.countdown.play().catch(e=>console.log('Som countdown:',e))}catch(e){}await new Promise(bL=>setTimeout(bL,1000))}c.countdown.innerHTML=`
    <div class="countdown-go" style="
      animation: countdown-go-cinema 0.8s ease-out;
      font-size: 15rem;
      font-weight: 900;
      background: linear-gradient(45deg, #00d9ff, #ff00e0, #fff300);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      text-shadow: 0 0 50px rgba(255, 255, 0, 1);
      letter-spacing: 10px;
    ">âš¡ AGORA! âš¡</div>
  `;if(F.go)try{F.go.currentTime=0;F.go.play().catch(e=>console.log('Som go:',e))}catch(e){}await new Promise(bM=>setTimeout(bM,1000));c.countdown.innerHTML='';_.countdownActive=!1;v()}function v(){_.isGameRunning=!0;let bN=_.currentAttempt-1,_c=setInterval(()=>{let bO=Date.now()-_B,bP=Math.max(0,g-bO),_C=o,_d=_C/9.80665,_e=(bO/1000);_.forceDataPerAttempt[bN].push({time:_e,force:_d});if(_d>_.forceMaxPerAttempt[bN]){_.forceMaxPerAttempt[bN]=_d;_d>_.totalMaxForce&&(_.totalMaxForce=_d);z(_d)}X(_d,(bP/1000).toFixed(1));bP<=0&&(clearInterval(_c),aJ())},12);_.forceMaxPerAttempt[bN]=0;_.forceDataPerAttempt[bN]=_.continuousForceData=[];c.currentPlayer.innerHTML=`
    <div class="attempt-info">
      <span>${_.playerName}</span>
      <span>Tentativa ${_.currentAttempt}/${_.maxAttempts}</span>
    </div>
  `;let _B=Date.now()}let w=!1;function X(bQ,bR=null){let bS=bQ*9.80665,_f=Math.min((bQ/B.maxForceDisplay)*100,100);c.forceDisplay.textContent=`${bQ.toFixed(1)} kg`;c.forceDisplay.style.fontSize='12rem';c.forceDisplay.style.fontWeight='900';c.forceDisplay.style.color=Y(bQ);c.forceDisplay.style.textShadow=`0 0 20px ${Y(bQ)}, 0 0 40px ${Y(bQ)}`;let _D=`(â‰ˆ ${bS.toFixed(1)} N)`;if(bR!==null&&!A(bR)){let bT=bR<=2?'#ff0000':'#ffd700';_D+=` <span style="color: ${bT}; font-weight: bold; margin-left: 20px;">â±ï¸ ${bR}s</span>`}c.newtonDisplay.innerHTML=_D;c.newtonDisplay.style.fontSize='2.5rem';c.newtonDisplay.style.fontWeight='bold';c.newtonDisplay.style.color='#aaa';let _E=Math.min((bQ/B.maxForceDisplay)*100,100);c.progressBar.style.width=`${_E}%`;c.progressBar.style.background=Y(bQ);c.verticalForceBar.style.height=`${_f}%`;if(bQ<10)c.verticalForceBar.style.background='linear-gradient(to top, rgba(52, 152, 219, 0.15), rgba(0, 217, 255, 0.05))';else if(bQ<30)c.verticalForceBar.style.background='linear-gradient(to top, rgba(46, 204, 113, 0.15), rgba(0, 217, 255, 0.05))';else if(bQ<60)c.verticalForceBar.style.background='linear-gradient(to top, rgba(243, 156, 18, 0.15), rgba(255, 102, 0, 0.08))';else if(bQ<100)c.verticalForceBar.style.background='linear-gradient(to top, rgba(231, 76, 60, 0.15), rgba(255, 0, 0, 0.10))';else bQ<200?c.verticalForceBar.style.background='linear-gradient(to top, rgba(155, 89, 182, 0.15), rgba(255, 0, 0, 0.12))':c.verticalForceBar.style.background='linear-gradient(to top, rgba(255, 20, 147, 0.20), rgba(255, 0, 0, 0.15))';c.labelForceCurrent&&(c.labelForceCurrent.textContent=`${bQ.toFixed(1)} kg`);c.forceMarkerCurrent&&(c.forceMarkerCurrent.style.bottom=`${_f}%`);let G=parseFloat(c.labelForceMax?.textContent?.split(':')[1]?.trim())||0;if(c.labelForceMax){c.labelForceMax.textContent=`${_.totalMaxForce.toFixed(1)} kg`;(_.totalMaxForce>G&&!w)&&(w=!0,c.forceMarkerMax.style.animation='none',void c.forceMarkerMax.offsetWidth,c.forceMarkerMax.style.animation='record-shock 0.6s ease-out',setTimeout(()=>{w=!1;c.forceMarkerMax.style.animation=''},600))}if(c.forceMarkerMax){let bU=Math.min((_.totalMaxForce/B.maxForceDisplay)*100,100);c.forceMarkerMax.style.bottom=`${bU}%`}}function Y(bV){if(bV<10)return'#3498db';if(bV<30)return'#2ecc71';if(bV<60)return'#f39c12';if(bV<100)return'#e74c3c';if(bV<200)return'#9b59b6';return'#ff1493'}function z(bW){let bX=0;if(bW>=200)bX=6;else if(bW>=100)bX=5;else if(bW>=60)bX=4;else if(bW>=30)bX=3;else if(bW>=10)bX=2;else bW>0&&(bX=1);if(bX>0&&F[`level${bX}`])try{F[`level${bX}`].currentTime=0;F[`level${bX}`].play().catch(e=>console.log(`Som level ${bX}:`,e))}catch(e){}}function aA(p0,p1,p2,p3,t){let a0=(-0.5*p0)+(1.5*p1)+(-1.5*p2)+(0.5*p3),a1=p0+(-2.5*p1)+(2*p2)+(-0.5*p3),a2=(-0.5*p0)+(0.5*p2),a3=p1;return a0*(t*t*t)+a1*(t*t)+a2*t+a3}function aB(bY,bZ,cA,cB,cC,_F){if(bY.length<2)return[];let _g=[];for(const cD of bY){let cE=Math.min(cD.time/(g/1000),1),cF=Math.min(cD.force/_F,1),x=bZ+cE*cB,y=cA-cF*cC;_g.push({x,y,force:cD.force})}let H=[];for(let i=0;i<_g.length-1;i++){const cG=_g[Math.max(0,i-1)],cH=_g[i],cI=_g[i+1],cJ=_g[Math.min(_g.length-1,i+2)],cK=8;for(let t=0;t<=1;t+=1/cK){const x=aA(cH.x,cI.x,cJ.x,cG.x,t),y=aA(cH.y,cI.y,cJ.y,cG.y,t);H.push({x,y})}}return H}function aC(cL,cM,cN,cO,cP,cQ,_G,_h){if(cM.length<2)return;let _i=aB(cM,cN,cO,cP,cQ,_G);cL.beginPath();for(const[i,cR] of _i.entries())i===0?cL.moveTo(cR.x,cR.y):cL.lineTo(cR.x,cR.y);cL.stroke()}function aD(){if(!c.forceGraphCanvas)return;let cS=c.forceGraphCanvas,cT=cS.parentElement.getBoundingClientRect(),cV=60,cW=20,cX=20,cY=40,_H=cS.width-cV-cW,_I=cS.height-cX-cY,J=cV,K=cS.height-cY,L=cU.createLinearGradient(0,0,0,cS.height),N=cS.width-220,O=cX+15;cS.width=cT.width;cS.height=cT.height;let cU=cS.getContext('2d');L.addColorStop(0,'rgba(15, 20, 40, 0.3)');L.addColorStop(1,'rgba(0, 0, 0, 0.4)');cU.fillStyle=L;cU.fillRect(0,0,cS.width,cS.height);cU.strokeStyle='rgba(0, 217, 255, 0.08)';cU.lineWidth=1;for(let i=0;i<=10;i++){const x=J+(_H/10)*i;cU.strokeStyle=i%2===0?'rgba(0, 217, 255, 0.08)':'rgba(0, 217, 255, 0.04)';cU.beginPath();cU.moveTo(x,cX);cU.lineTo(x,cS.height-cY);cU.stroke()}for(let i=0;i<=5;i++){const y=K-(_I/5)*i;cU.strokeStyle=i%2===0?'rgba(0, 217, 255, 0.08)':'rgba(0, 217, 255, 0.04)';cU.beginPath();cU.moveTo(J,y);cU.lineTo(cS.width-cW,y);cU.stroke()}let M=[{line:'#00d9ff',glow:'#00d9ff',fill:'rgba(0, 217, 255, 0.1)'},{line:'#ff00e0',glow:'#ff00e0',fill:'rgba(255, 0, 224, 0.1)'},{line:'#fff300',glow:'#fff300',fill:'rgba(255, 243, 0, 0.1)'}];for(let cZ=0;cZ<_.currentAttempt;cZ++){const dA=_.forceDataPerAttempt[cZ],dC=0;if(!dA||dA.length===0)continue;const dB=M[cZ];cU.globalAlpha=0.15;cU.fillStyle=dB.fill;cU.beginPath();for(const[i,point] of dA.entries()){let dF=Math.min(point.time/(g/1000),1),dG=Math.min(point.force/B.maxForceDisplay,1),x=J+dF*_H,y=K-dG*_I;i===0?cU.moveTo(x,y):cU.lineTo(x,y)}cU.lineTo(cS.width-cW,K);cU.lineTo(J,K);cU.closePath();cU.fill();cU.globalAlpha=1.0;cU.lineWidth=6;cU.lineCap=cU.lineJoin='round';cU.shadowColor=dB.glow;cU.shadowBlur=20;cU.shadowOffsetX=cU.shadowOffsetY=0;cU.strokeStyle=dB.glow;cU.globalAlpha=0.3;aC(cU,dA,J,K,_H,_I,B.maxForceDisplay,dB.line);cU.globalAlpha=1.0;cU.lineWidth=5;cU.shadowBlur=15;cU.strokeStyle=dB.line;aC(cU,dA,J,K,_H,_I,B.maxForceDisplay,dB.line);let dD=0,dE=0;for(const point of dA){let dH=Math.min(point.time/(g/1000),1),dI=Math.min(point.force/B.maxForceDisplay,1);point.force>dC&&(dC=point.force,dD=J+dH*_H,dE=K-dI*_I)}cU.shadowBlur=25;cU.shadowColor=dB.glow;cU.fillStyle=`rgba(${dB.glow==='#00d9ff'?'0, 217, 255':dB.glow==='#ff00e0'?'255, 0, 224':'255, 243, 0'}, 0.2)`;cU.beginPath();cU.arc(dD,dE,20,0,Math.PI*2);cU.fill();cU.fillStyle=dB.line;cU.beginPath();cU.arc(dD,dE,10,0,Math.PI*2);cU.fill();cU.strokeStyle='rgba(255, 255, 255, 0.9)';cU.lineWidth=3;cU.beginPath();cU.arc(dD,dE,12,0,Math.PI*2);cU.stroke();cU.font='bold 16px Arial';cU.fillStyle=dB.line;cU.textAlign='center';cU.shadowColor='rgba(0, 0, 0, 0.8)';cU.shadowBlur=8;cU.shadowOffsetX=0;cU.shadowOffsetY=2;cU.fillText(`${dC.toFixed(1)}kg`,dD,dE-25);cU.shadowBlur=0}cU.shadowColor='rgba(0, 217, 255, 0.5)';cU.shadowBlur=8;cU.strokeStyle='rgba(0, 217, 255, 0.6)';cU.lineWidth=2;cU.beginPath();cU.moveTo(J,K);cU.lineTo(cS.width-cW,K);cU.stroke();cU.beginPath();cU.moveTo(J,cX);cU.lineTo(J,K);cU.stroke();cU.shadowBlur=0;cU.font='bold 12px Arial';cU.textAlign='right';for(let i=0;i<=5;i++){const dJ=(B.maxForceDisplay/5)*i,y=K-(_I/5)*i;cU.fillStyle='rgba(0, 217, 255, 0.9)';cU.fillText(`${dJ.toFixed(0)}kg`,J-15,y+4)}cU.font='bold 12px Arial';cU.textAlign='center';for(let i=0;i<=10;i+=2){cU.fillStyle='rgba(0, 217, 255, 0.9)';cU.fillText(`${i}s`,J+(_H/10)*i,cS.height-cY+22)}cU.font='bold 13px Arial';cU.textAlign='left';for(let i=0;i<_.currentAttempt;i++){const dK=M[i];cU.fillStyle='rgba(0, 0, 0, 0.3)';cU.fillRect(N-8,O+i*28-12,180,24);cU.fillStyle=dK.line;cU.fillRect(N-4,O+i*28-8,20,4);cU.fillStyle='rgba(255, 255, 255, 0.95)';cU.fillText(`âš¡ Tentativa ${i+1} â€¢ ${_.forceMaxPerAttempt[i].toFixed(1)}kg`,N+22,O+i*28-2)}}function aG(){let dL=performance.now();if(dL-aE>=aF){_.isGameRunning?aD():aI();aE=dL}}function aH(dM,dN,dO,dP,dQ){const dR=[];for(let i=0;i<dM.length-1;i++){const dS=dM[Math.max(0,i-1)],dT=dM[i],dU=dM[i+1],dV=dM[Math.min(dM.length-1,i+2)],dW=8;for(let t=0;t<=1;t+=1/dW){const x=aA(dT.x,dU.x,dV.x,dS.x,t),y=aA(dT.y,dU.y,dV.y,dS.y,t);dR.push({x,y})}}return dR}function aI(){if(!c.forceGraphCanvas)return;let dX=c.forceGraphCanvas,dY=dX.parentElement.getBoundingClientRect(),eA=60,eB=20,eC=20,eD=40,eE=dX.width-eA-eB,eF=dX.height-eC-eD,_j=eA,_k=dX.height-eD,_l=dZ.createLinearGradient(0,0,0,dX.height),_n=[];dX.width=dY.width;dX.height=dY.height;let dZ=dX.getContext('2d');_l.addColorStop(0,'rgba(15, 20, 40, 0.3)');_l.addColorStop(1,'rgba(0, 0, 0, 0.4)');dZ.fillStyle=_l;dZ.fillRect(0,0,dX.width,dX.height);dZ.lineWidth=1;for(let i=0;i<=10;i++){const x=_j+(eE/10)*i;dZ.strokeStyle=i%2===0?'rgba(0, 217, 255, 0.08)':'rgba(0, 217, 255, 0.04)';dZ.beginPath();dZ.moveTo(x,eC);dZ.lineTo(x,_k);dZ.stroke()}for(let i=0;i<=5;i++){const y=_k-(eF/5)*i;dZ.strokeStyle=i%2===0?'rgba(0, 217, 255, 0.08)':'rgba(0, 217, 255, 0.04)';dZ.beginPath();dZ.moveTo(_j,y);dZ.lineTo(dX.width-eB,y);dZ.stroke()}let _m=_.continuousForceData;if(!_m||_m.length===0)return;for(const[i,point] of _m.entries()){let eG=i/834,eH=Math.min(point.force/B.maxForceDisplay,1),x=_j+eG*eE,y=_k-eH*eF;_n.push({x,y,force:point.force})}_m.length!==_.continuousForcePathCacheVersion&&(_.continuousForcePathCache=aH(_n,_j,_k,eE,eF),_.continuousForcePathCacheVersion=_m.length);let _o=_.continuousForcePathCache;dZ.globalAlpha=0.15;dZ.fillStyle='rgba(0, 217, 255, 0.3)';dZ.beginPath();for(const[i,eI] of _n.entries())i===0?dZ.moveTo(eI.x,eI.y):dZ.lineTo(eI.x,eI.y);dZ.lineTo(dX.width-eB,_k);dZ.lineTo(_j,_k);dZ.closePath();dZ.fill();dZ.globalAlpha=1.0;dZ.lineWidth=6;dZ.lineCap=dZ.lineJoin='round';dZ.shadowColor='#00d9ff';dZ.shadowBlur=20;dZ.shadowOffsetX=dZ.shadowOffsetY=0;dZ.strokeStyle='#00d9ff';dZ.globalAlpha=0.3;dZ.beginPath();for(const[i,eJ] of _o.entries())i===0?dZ.moveTo(eJ.x,eJ.y):dZ.lineTo(eJ.x,eJ.y);dZ.stroke();dZ.globalAlpha=1.0;dZ.lineWidth=4;dZ.shadowBlur=15;dZ.strokeStyle='#00d9ff';dZ.beginPath();for(const[i,eK] of _o.entries())i===0?dZ.moveTo(eK.x,eK.y):dZ.lineTo(eK.x,eK.y);dZ.stroke();dZ.shadowBlur=0;dZ.shadowColor='rgba(0, 217, 255, 0.5)';dZ.shadowBlur=8;dZ.strokeStyle='rgba(0, 217, 255, 0.6)';dZ.lineWidth=2;dZ.beginPath();dZ.moveTo(_j,_k);dZ.lineTo(dX.width-eB,_k);dZ.stroke();dZ.beginPath();dZ.moveTo(_j,eC);dZ.lineTo(_j,_k);dZ.stroke();dZ.shadowBlur=0;dZ.font='bold 12px Arial';dZ.textAlign='right';for(let i=0;i<=5;i++){const eL=(B.maxForceDisplay/5)*i,y=_k-(eF/5)*i;dZ.fillStyle='rgba(0, 217, 255, 0.9)';dZ.fillText(`${eL.toFixed(0)}kg`,_j-15,y+4)}dZ.font='bold 12px Arial';dZ.textAlign='center';for(let i=0;i<=10;i+=2){dZ.fillStyle='rgba(0, 217, 255, 0.9)';const eM=i-10;dZ.fillText(eM===0?'Agora':`${eM}s`,_j+(eE/10)*i,dX.height-eD+22)}}function aJ(){_.isGameRunning=!1;let eN=_.currentAttempt-1,eO=_.forceMaxPerAttempt[eN],eP=aM(eO);c.attemptMessage.textContent=eP;c.attemptMessage.classList.add('visible');setTimeout(()=>c.attemptMessage.classList.remove('visible'),5000);_.attempts.push({attempt:_.currentAttempt,force:eO,timestamp:new Date().toLocaleString('pt-BR')});_.currentAttempt<_.maxAttempts?(_.currentAttempt++,setTimeout(()=>u(),5500)):(setTimeout(()=>aK(),5500))}function aK(){s('results');let eQ=_.totalMaxForce,eR=eQ*9.80665;c.resultForce.innerHTML=`
    <div class="result-force-display">
      <div class="force-value">${eQ.toFixed(1)} kg</div>
      <div class="force-newton">(â‰ˆ ${eR.toFixed(1)} N)</div>
    </div>
  `;let eS=aM(eQ);c.motivationalMessage.textContent=eS;c.playerNameResult.value=_.playerName;aQ(_.playerName,eQ,eR);if(F.result)try{F.result.play().catch(e=>console.log('Som result:',e))}catch(e){}aL()}function aL(){clearTimeout(j);j=setTimeout(()=>aS(),15000)}function aM(eT){if(!d)return'Preparando o deboche...';let eU=(eT/B.maxForceDisplay)*100,eV=null,eX=eW.frases[~~Math.random()*eW.frases.length];if(eU<=B.thresholds.fraca)eV='fraca';else if(eU<=B.thresholds.media)eV='media';else if(eU<=B.thresholds.alta)eV='alta';else eU<=B.thresholds.muito_alta?eV='muito_alta':eV='epica';let eW=d.forcas.find(f=>f.nivel===eV);if(!eW||eW.frases.length===0)return'Sua forÃ§a Ã© tÃ£o indescritÃ­vel que nÃ£o achei uma frase para ela.';return eX.texto}function aN(){let eY=JSON.parse(localStorage.getItem('martelo_settings')),eZ={maxForceDisplay:300,useDynamicMaxForce:!0,thresholds:{fraca:20,media:50,alta:80,muito_alta:95,epica:100}},fA={...eZ,...eY};fA.thresholds={...eZ.thresholds,...eY?.thresholds};B=fA;if(B.useDynamicMaxForce){let fB=JSON.parse(localStorage.getItem('martelo_ranking')||'[]');fB.length>0?B.maxForceDisplay=Math.ceil(fB[0].forceKg/10)*10:B.maxForceDisplay=eZ.maxForceDisplay;c.maxForceInput.disabled=!0;c.maxForceInput.value='';c.maxForceInput.placeholder=`AutomÃ¡tico (${B.maxForceDisplay} kg)`}else{c.maxForceInput.disabled=!1;c.maxForceInput.value=B.maxForceDisplay;c.maxForceInput.placeholder='kg'}c.dynamicMaxForceCheckbox.checked=B.useDynamicMaxForce;c.thresholdFraca.value=B.thresholds.fraca;c.thresholdMedia.value=B.thresholds.media;c.thresholdAlta.value=B.thresholds.alta;c.thresholdMuitoAlta.value=B.thresholds.muito_alta;c.thresholdEpica.value=B.thresholds.epica}function aO(){let fC=c.dynamicMaxForceCheckbox.checked,fD=parseInt(c.maxForceInput.value);localStorage.setItem('martelo_settings',JSON.stringify({useDynamicMaxForce:fC,maxForceDisplay:fC?0:(fD||300),thresholds:{fraca:parseInt(c.thresholdFraca.value)||20,media:parseInt(c.thresholdMedia.value)||50,alta:parseInt(c.thresholdAlta.value)||80,muito_alta:parseInt(c.thresholdMuitoAlta.value)||95,epica:parseInt(c.thresholdEpica.value)||100}}));alert('ConfiguraÃ§Ãµes salvas!');aN();s('start')}function aP(){aN();s('settings')}function aQ(fE,fF,fG){try{let fH=JSON.parse(localStorage.getItem('martelo_ranking')||'[]'),fI=fH.length>0?fH[0]:null,fK=_.forceDataPerAttempt[fJ];(fI&&fF>fI.forceKg)&&aX(fE,fF,fI);let fJ=_.forceMaxPerAttempt.indexOf(Math.max(..._.forceMaxPerAttempt));k=Date.now();fH.push({id:k,name:fE,forceKg:fF,forceN:fG,date:new Date().toLocaleString('pt-BR'),curveData:fK});fH.sort((a,b)=>b.forceKg-a.forceKg);localStorage.setItem('martelo_ranking',JSON.stringify(fH))}catch(e){console.error('Erro ao salvar o ranking:',e);alert('Ocorreu um erro ao salvar o ranking. Verifique o console para mais detalhes.')}}function aR(fL){_.playerName=fL;try{let fM=JSON.parse(localStorage.getItem('martelo_ranking')||'[]'),fN=fM.findIndex(fO=>fO.id===k);fN!==-1&&(fM[fN].name=fL,localStorage.setItem('martelo_ranking',JSON.stringify(fM)))}catch(e){console.error('Erro ao atualizar o nome no ranking:',e)}}function aS(){s('ranking');aT()}function aT(){try{let fP=JSON.parse(localStorage.getItem('martelo_ranking')||'[]');c.rankingTableBody.innerHTML='';if(fP.length===0){c.rankingTableBody.innerHTML='<tr><td colspan="5">Nenhum registro ainda!</td></tr>';return}let fQ=['ğŸ¥‡','ğŸ¥ˆ','ğŸ¥‰'];for(const[fR,fS] of fP.entries()){let fT=document.createElement('tr'),fU=document.createElement('td'),fW=document.createElement('td'),fY=document.createElement('canvas');fU.textContent=fQ[fR]||`${fR+1}Âº`;fT.appendChild(fU);let fV=document.createElement('td');fV.textContent=fS.name;fT.appendChild(fV);fW.textContent=`${fS.forceKg.toFixed(1)} kg (${fS.forceN.toFixed(0)} N)`;fT.appendChild(fW);let fX=document.createElement('td');fY.width=150;fY.height=50;fX.appendChild(fY);fT.appendChild(fX);let fZ=document.createElement('td');fZ.textContent=fS.date;fT.appendChild(fZ);c.rankingTableBody.appendChild(fT);fS.curveData&&aW(fY,fS.curveData)}}catch(e){console.error('Erro ao atualizar a tabela de ranking:',e);c.rankingTableBody.innerHTML='<tr><td colspan="5">Ocorreu um erro ao carregar o ranking.</td></tr>'}}function aU(){confirm('VocÃª tem certeza que deseja limpar TODO o ranking? Esta aÃ§Ã£o nÃ£o pode ser desfeita.')&&(localStorage.removeItem('martelo_ranking'),aT(),console.log('Ranking limpo pelo usuÃ¡rio.'))}function aV(){let gA=JSON.parse(localStorage.getItem('martelo_ranking')||'[]'),gB=gA.slice(0,3);for(const gC of Object.values(c.rankingMarkers))gC&&gC.classList.remove('visible');for(const[index,entry] of gB.entries()){let gD=c.rankingMarkers[`marker${index+1}`];if(!gD)continue;let gE=Math.min((entry.forceKg/B.maxForceDisplay)*100,100);gD.style.bottom=`${gE}%`;gD.innerHTML=`<span>${index+1}Âº - ${entry.name}: ${entry.forceKg.toFixed(1)} kg</span>`;gD.classList.add('visible')}}function aW(gF,gG){let gH=gF.getContext('2d'),gI=gF.width,gJ=gF.height,gL=Math.max(...gG.map(p=>p.time));gH.clearRect(0,0,gI,gJ);if(!gG||gG.length===0)return;let gK=Math.max(...gG.map(p=>p.force));gH.beginPath();gH.strokeStyle='#00d9ff';gH.lineWidth=2;gH.shadowColor='#00d9ff';gH.shadowBlur=5;for(const[i,point] of gG.entries()){let x=(point.time/gL)*gI,y=gJ-(point.force/gK)*gJ;i===0?gH.moveTo(x,y):gH.lineTo(x,y)}gH.stroke()}function aX(gM,gN,gO){let gP=document.getElementById('modal-novo-recorde'),gQ=document.getElementById('modal-recorde-mensagem'),gR=document.getElementById('modal-recorde-sua-forca'),gS=document.getElementById('modal-recorde-anterior');if(!gP||!gQ||!gR||!gS){console.error('Erro: Um ou mais elementos do modal de novo recorde nÃ£o foram encontrados.');return}gQ.textContent=`VocÃª ultrapassou a marca de ${gO.name}!`;gR.textContent=`${gN.toFixed(1)} kg`;gS.textContent=`${gO.forceKg.toFixed(1)} kg`;gP.style.display='flex';F.newRecord&&F.newRecord.play().catch(e=>console.log('Som newRecord:',e))}function aY(){c.modalNovoRecorde.style.display='none'}function aZ(){c.modalSobrecarga&&c.modalSobrecarga.classList.remove('ativo')}function bA(gT){if(!c.modalSobrecarga)return;const{level:gU,percent:gV,forca:gW,capacidade:gX,displayUnit:gY}=gT,gZ=bB(Math.abs(gW),gY),hA=bB(gX,gY);c.modalSobrecargaValorAtual.textContent=`${gZ.toFixed(1)} ${gY}`;c.modalSobrecargaValorLimite.textContent=`${hA.toFixed(1)} ${gY}`;c.modalSobrecargaPercentual.textContent=`${gV.toFixed(1)}%`;c.modalSobrecargaBarraProgresso.style.width=`${Math.min(gV,100)}%`;let hB=c.modalSobrecarga.querySelector('.modal-sobrecarga-content');hB.classList.remove('alerta-80','alerta-90','alerta-100');if(gU>=100){hB.classList.add('alerta-100');c.modalSobrecargaTitulo.textContent='ğŸš¨ LIMITE EXCEDIDO! PARE IMEDIATAMENTE! ğŸš¨';c.modalSobrecargaMensagem.innerHTML=`
      â›” <strong>LIMITE DA CÃ‰LULA ULTRAPASSADO!</strong><br>
      <strong style="font-size: 1.15rem; color: #7f1d1d;">RISCO CRÃTICO DE DESTRUIÃ‡ÃƒO DO EQUIPAMENTO!</strong>
    `}else if(gU>=90){hB.classList.add('alerta-90');c.modalSobrecargaTitulo.textContent='ğŸš¨ PERIGO: MUITO PRÃ“XIMO DO LIMITE! ğŸš¨';c.modalSobrecargaMensagem.innerHTML=`
      âš ï¸ VocÃª estÃ¡ em zona crÃ­tica!<br>
      <strong>RISCO IMINENTE DE DANOS PERMANENTES!</strong>
    `}else gU>=80&&(hB.classList.add('alerta-80'),c.modalSobrecargaTitulo.textContent='âš ï¸ ATENÃ‡ÃƒO: APROXIMANDO DO LIMITE! âš ï¸',c.modalSobrecargaMensagem.innerHTML=`
      âš ï¸ VocÃª estÃ¡ prÃ³ximo do limite da cÃ©lula de carga!<br>
      <strong>RISCO DE DANOS PERMANENTES AO EQUIPAMENTO!</strong>
    `)}function bB(hC,hD){let hE=101.9716;if(hD==='gf')return hC*hE;if(hD==='kgf')return hC*(hE/1000);return hC}function bC(){c.playerNameInput.value=_.playerName='';_.currentAttempt=1;_.forceMaxPerAttempt=[0,0,0];_.totalMaxForce=0;_.attempts=[];_.forceDataPerAttempt=[[],[],[]];c.forceDisplay.textContent='0.0 kg';c.newtonDisplay.textContent='(â‰ˆ 0.0 N)';c.progressBar.style.width=c.verticalForceBar.style.height='0%';c.forceMarkerCurrent&&(c.forceMarkerCurrent.style.bottom='0%');c.forceMarkerMax&&(c.forceMarkerMax.style.bottom='0%');c.labelForceCurrent&&(c.labelForceCurrent.textContent='0 kg');c.labelForceMax&&(c.labelForceMax.textContent='0 kg');s('start')}document.readyState==='loading'?(document.addEventListener('DOMContentLoaded',()=>{r();console.log('âœ“ Martelo do Thor - Polling de forÃ§a iniciado')})):(r(),console.log('âœ“ Martelo do Thor - Polling de forÃ§a iniciado'));function bD(){I=document.createElement('div');I.id='debug-panel-martelo';I.style.cssText=`
    position: fixed;
    top: 20px;
    right: 20px;
    background: #0a0a0a;
    color: #0f0;
    padding: 12px 16px;
    border-radius: 8px;
    font-family: 'Courier New', monospace;
    font-size: 13px;
    z-index: 9999;
    border: 2px solid #0f0;
    box-shadow: 0 0 10px rgba(0, 255, 0, 0.5), inset 0 0 5px rgba(0, 255, 0, 0.2);
    line-height: 1.5;
    user-select: none;
    pointer-events: none;
  `;document.body.appendChild(I);setInterval(bE,100)}function bE(){if(!I)return;let hF=P?'âœ“':'âœ—',hG=P?'#0f0':'#f00';I.innerHTML=`
    <div style="color: #0f0; font-weight: bold; margin-bottom: 5px;">âš¡ FORÃ‡A - DEBUG</div>
    <div style="color: ${hG}; margin-bottom: 3px;">${hF} Status: ${P?'ATIVO':'INATIVO'}</div>
    <div>N: ${o.toFixed(2)} N</div>
    <div>kg: ${(o/9.80665).toFixed(3)} kg</div>
    <div style="color: #888; font-size: 11px; margin-top: 3px;">Pressione D para mais</div>
  `}function bF(){console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');console.log('ğŸ” DEBUG DETALHADO - LEITURA DE FORÃ‡A');console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');console.log('Status do Polling:',P?'âœ“ ATIVO':'âœ— INATIVO');console.log('Valor Atual (N):',o.toFixed(2));console.log('Valor Atual (kg):',(o/9.80665).toFixed(3));console.log('Erro de Polling:',q||'nenhum');console.log('window.opener disponÃ­vel:',!!window.opener);window.opener&&(console.log('window.opener.sharedState.forcaAtual:',window.opener.sharedState.forcaAtual),console.log('typeof window.opener.sharedState.forcaAtual:',typeof window.opener.sharedState.forcaAtual));console.log('Estado do Jogo:',{playerName:_.playerName,currentAttempt:_.currentAttempt,totalMaxForce:_.totalMaxForce,isGameRunning:_.isGameRunning});console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');let hH=document.createElement('div');hH.style.cssText=`
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: #1a1a1a;
    color: #0f0;
    padding: 20px;
    border-radius: 12px;
    font-family: 'Courier New', monospace;
    font-size: 13px;
    z-index: 10000;
    border: 2px solid #0f0;
    box-shadow: 0 0 20px rgba(0, 255, 0, 0.7);
    max-width: 400px;
    line-height: 1.6;
  `;hH.innerHTML=`
    <div style="margin-bottom: 10px; border-bottom: 1px solid #0f0; padding-bottom: 10px;">
      <strong style="font-size: 16px;">âš¡ DEBUG DETALHADO</strong>
    </div>
    <div style="margin-bottom: 15px;">
      <strong>ğŸ“Š LEITURA DE FORÃ‡A</strong><br>
      Status: <span style="color: ${P?'#0f0':'#f00'}; font-weight: bold;">${P?'âœ“ ATIVO':'âœ— INATIVO'}</span><br>
      Valor: <span style="color: #ff0;">${o.toFixed(2)} N</span><br>
      Valor: <span style="color: #ff0;">${(o/9.80665).toFixed(3)} kg</span><br>
      Erro: ${q||'<span style="color: #0f0;">nenhum</span>'}
    </div>
    <div style="margin-bottom: 15px;">
      <strong>ğŸ”— CONEXÃƒO COM JANELA PAI</strong><br>
      window.opener: <span style="color: ${window.opener?'#0f0':'#f00'};">${window.opener?'âœ“ DisponÃ­vel':'âœ— NÃ£o disponÃ­vel'}</span><br>
      ${window.opener?`sharedState.forcaAtual: <span style="color: #ff0;">${window.opener.sharedState?window.opener.sharedState.forcaAtual:'undefined'}</span>`:''}
    </div>
    <div style="margin-bottom: 15px; border-top: 1px solid #0f0; padding-top: 10px;">
      <strong>ğŸ® ESTADO DO JOGO</strong><br>
      Jogador: ${_.playerName||'(nÃ£o iniciado)'}<br>
      Tentativa: ${_.currentAttempt}/3<br>
      MÃ¡ximo: ${_.totalMaxForce.toFixed(2)} N<br>
      Rodando: ${_.isGameRunning?'âœ“ Sim':'âœ— NÃ£o'}
    </div>
    <div style="text-align: center; font-size: 11px; color: #888;">
      Pressione D novamente ou clique para fechar
    </div>
  `;document.body.appendChild(hH);hH.addEventListener('click',()=>hH.remove());setTimeout(()=>{hH.parentNode&&hH.remove()},10000);let hI=e=>{if(e.key==='d'||e.key==='D'){hH.parentNode&&hH.remove();document.removeEventListener('keydown',hI)}};document.addEventListener('keydown',hI)}console.log('âœ“ Martelo do Thor - Script carregado com sucesso!');
