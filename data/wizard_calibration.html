<!-- WIZARD DE CALIBRA√á√ÉO SIMPLIFICADO -->
<div id="wizard-modal" class="wizard-modal" style="display: none;">
  <div class="wizard-content" style="max-width: 800px;">
    <div class="wizard-header">
      <h2>üßô‚Äç‚ôÇÔ∏è Assistente de Calibra√ß√£o da Balan√ßa</h2>
      <button class="wizard-close" onclick="closeWizard()">&times;</button>
    </div>

    <div class="wizard-progress">
      <div class="wizard-progress-bar"></div>
    </div>

    <div class="wizard-body">
      <!-- PASSO 0: An√°lise de Ru√≠do -->
      <div id="wizard-step-0" class="wizard-step">
        <h3>Passo 1/7: An√°lise de Ru√≠do (Balan√ßa Vazia)</h3>
        <p>Neste passo, vamos medir o ru√≠do eletr√¥nico do sistema. Certifique-se de que a balan√ßa esteja <strong>completamente vazia e est√°vel</strong>.</p>
        <div class="wizard-realtime-box">
          <h4>Leitura em Tempo Real</h4>
          <div id="wizard-leitura-passo0">--</div>
        </div>
        <div id="wizard-analise-status" style="display: none; margin-top: 1rem; padding: 1rem; background: var(--cor-info-light); border-radius: 8px;">
          <h4>An√°lise Conclu√≠da</h4>
          <p>Ru√≠do medido (desvio padr√£o): <strong id="wizard-ruido-medido">---</strong></p>
          <p class="wizard-info-text">Este valor representa a instabilidade natural do sensor. Quanto menor, melhor.</p>
        </div>
      </div>

      <!-- PASSO 1: Especifica√ß√µes da C√©lula -->
      <div id="wizard-step-1" class="wizard-step">
        <h3>Passo 2/7: Especifica√ß√µes da C√©lula de Carga</h3>
        <p>Informe os dados do fabricante da sua c√©lula de carga. Estes valores s√£o encontrados no datasheet do componente.</p>
        <div class="wizard-form-grid">
          <div>
            <label for="wizard-capacity-input">Capacidade M√°xima (kg)</label>
            <input type="number" id="wizard-capacity-input" step="any" placeholder="Ex: 5" oninput="calculateStabilityParameters()">
            <small class="wizard-info-text">Capacidade nominal da c√©lula. Ex: 5 para uma c√©lula de 5kg.</small>
          </div>
          <div>
            <label for="wizard-accuracy-input">Classe de Acur√°cia (%)</label>
            <input type="number" id="wizard-accuracy-input" step="any" placeholder="Ex: 0.03" oninput="calculateStabilityParameters()">
            <small class="wizard-info-text">Classe de precis√£o. Ex: 0.03 para C3, 0.1 para D1.</small>
          </div>
        </div>
        <div id="wizard-tolerancia-calculada" style="display: none; margin-top: 1rem; padding: 1rem; background: var(--cor-fundo-secundario); border-radius: 8px;">
            <h4>Par√¢metros Derivados</h4>
            <p>Erro m√°ximo esperado (fabricante): <strong id="wizard-erro-maximo-valor">---</strong> g</p>
            <p>Toler√¢ncia de estabiliza√ß√£o: <strong id="wizard-tolerancia-valor">---</strong></p>
        </div>
      </div>

      <!-- PASSO 2: Coletar Ponto Zero -->
      <div id="wizard-step-2" class="wizard-step">
        <h3>Passo 3/7: Coletar Ponto Zero</h3>
        <p>A balan√ßa precisa saber qual √© a leitura correspondente a <strong>zero quilos</strong>. Mantenha a balan√ßa vazia e clique em "Avan√ßar" para registrar o ponto zero.</p>
        <div class="wizard-realtime-box">
          <h4>Leitura em Tempo Real</h4>
          <div id="wizard-leitura-passo2">--</div>
        </div>
      </div>

      <!-- PASSO 3: Pontos de Calibra√ß√£o -->
      <div id="wizard-step-3" class="wizard-step">
        <h3>Passo 4/7: Adicionar Massas Conhecidas</h3>
        <p>Coloque um peso de massa conhecida sobre a balan√ßa, digite o valor em gramas e clique em "Adicionar Ponto". Adicione pelo menos 1 ou 2 pontos para uma boa calibra√ß√£o.</p>
        <div class="wizard-form-grid">
          <input type="number" id="wizard-peso-conhecido" placeholder="Massa em gramas (ex: 1000)">
          <button onclick="wizardAdicionarPonto()" class="btn btn-info">‚ûï Adicionar Ponto</button>
        </div>
        <div class="wizard-realtime-box" style="margin-top: 1rem;">
            <h4>Leitura em Tempo Real</h4>
            <div id="wizard-leitura-passo3">--</div>
        </div>
        <h4 style="margin-top: 1.5rem;">Pontos Coletados</h4>
        <div id="wizard-lista-pontos" class="wizard-point-list"></div>
      </div>

      <!-- PASSO 4: Resultados da Regress√£o -->
      <div id="wizard-step-4" class="wizard-step">
        <h3>Passo 5/7: Resultados da Calibra√ß√£o</h3>
        <p>Com base nos pontos coletados, calculamos a equa√ß√£o da reta (m = Œ±¬∑N + Œ≤) que converte a leitura bruta (ADC) em massa (kg).</p>
        <div id="wizard-resultado-regressao" class="wizard-results-grid">
            <div>
                <h4>Ganho (Œ±)</h4>
                <p id="wizard-alpha-valor">---</p>
                <small>kg / Leitura ADC</small>
            </div>
            <div>
                <h4>Offset (Œ≤)</h4>
                <p id="wizard-beta-valor">---</p>
                <small>kg</small>
            </div>
            <div>
                <h4>Qualidade (R¬≤)</h4>
                <p id="wizard-r2-valor">---</p>
                <small>Pr√≥ximo de 1.0 = perfeito</small>
            </div>
            <div>
                <h4>Erro M√°ximo Medido</h4>
                <p><span id="wizard-erro-max-valor">---</span> g</p>
                <small>Maior diferen√ßa entre o peso real e o medido</small>
            </div>
        </div>
        <div style="margin-top: 1rem; padding: 1rem; background: var(--cor-fundo-secundario); border-radius: 8px;">
            <h4>Toler√¢ncia de Estabiliza√ß√£o Calculada</h4>
            <p id="wizard-tolerancia-final" style="white-space: pre-wrap;">---</p>
            <small>Este valor ser√° usado para determinar se a leitura da balan√ßa est√° est√°vel. √â baseado no ru√≠do medido e na precis√£o da c√©lula.</small>
        </div>
      </div>

      <!-- PASSO 5: Gr√°fico da Regress√£o -->
      <div id="wizard-step-5" class="wizard-step">
        <h3>Passo 6/7: Gr√°fico da Regress√£o</h3>
        <p>O gr√°fico mostra os pontos que voc√™ coletou (em verde) e a linha de regress√£o calculada (em azul). Pontos bem alinhados indicam uma boa calibra√ß√£o.</p>
        <div style="text-align: center; margin-bottom: 1rem;">
            <canvas id="wizard-grafico-canvas" width="700" height="400" style="border: 1px solid var(--cor-borda); border-radius: 8px;"></canvas>
            <p>√Çngulo da Regress√£o: <strong id="regression-angle">---</strong></p>
        </div>
      </div>

      <!-- PASSO 6: Resumo e Salvar -->
      <div id="wizard-step-6" class="wizard-step">
        <h3>Passo 7/7: Resumo e Salvar Configura√ß√µes</h3>
        <p>Revise os par√¢metros calculados e escolha quais deseja salvar permanentemente na mem√≥ria do ESP32.</p>
        <div class="wizard-summary">
            <h4>Par√¢metros Finais</h4>
            <p><strong>Capacidade:</strong> <span id="wizard-resumo-capacidade">---</span> kg</p>
            <p><strong>Ganho (Œ±):</strong> <span id="wizard-resumo-alpha">---</span></p>
            <p><strong>Offset (Œ≤):</strong> <span id="wizard-resumo-beta">---</span></p>
            <p><strong>Toler√¢ncia de Estabiliza√ß√£o:</strong> <span id="wizard-resumo-tolerancia">---</span></p>
            <p><strong>Erro M√°ximo (Fabricante):</strong> <span id="wizard-resumo-erro-maximo">---</span> g</p>
        </div>
        <div class="wizard-save-options">
            <h4>Op√ß√µes de Salvamento</h4>
            <label><input type="checkbox" id="wizard-salvar-fator" checked> Salvar Fator de Convers√£o e Offset de Tara</label>
            <label><input type="checkbox" id="wizard-salvar-capacidade"> Salvar Capacidade e Acur√°cia da C√©lula</for></label>
            <label><input type="checkbox" id="wizard-salvar-tolerancia"> Salvar Toler√¢ncia de Estabiliza√ß√£o</label>
        </div>
      </div>

    </div>

    <div class="wizard-footer">
      <button id="wizard-btn-prev" onclick="wizardGoToStepSimple(-1)" class="btn btn-secundario">Voltar</button>
      <button id="wizard-btn-next" onclick="wizardGoToStepSimple(1)" class="btn btn-primario">Avan√ßar</button>
      <button id="wizard-btn-finish" onclick="wizardPasso6_Finalizar()" class="btn btn-sucesso" style="display: none;">üíæ Finalizar e Salvar</button>
    </div>
  </div>
</div>


