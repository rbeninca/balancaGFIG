<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‚ö° MARTELO DO THOR - TESTE DE FOR√áA √âPICO</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Arial Black', sans-serif;
      background: #0a0a0a;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      color: white;
      overflow: hidden;
    }

    .container-fullscreen {
      width: 100%;
      height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      align-items: center;
      padding: 2rem;
      position: relative;
      background: radial-gradient(ellipse at center, #1a1a2e 0%, #0a0a0a 100%);
    }

    /* ============= RAIOS MASSIVOS ============= */
    .raios-fundo {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 0;
    }

    .raio {
      position: absolute;
      background: linear-gradient(90deg, transparent, #00d4ff, #0099ff, transparent);
      opacity: 0;
      filter: blur(2px);
      box-shadow: 0 0 20px #00d4ff, 0 0 40px #0099ff;
    }

    .raio.ativo {
      animation: raio-strike 0.3s ease-out;
    }

    @keyframes raio-strike {
      0% {
        opacity: 0;
        filter: blur(5px);
      }
      20% {
        opacity: 1;
        filter: blur(1px);
      }
      50% {
        opacity: 0.8;
        filter: blur(0.5px);
      }
      100% {
        opacity: 0;
        filter: blur(3px);
      }
    }

    /* ============= LOGOS DIN√ÇMICAS ============= */
    .logos-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 2;
    }

    .logo-dynamic {
      position: absolute;
      width: 140px;
      height: 140px;
      opacity: 0.4;
      filter: brightness(1.5) drop-shadow(0 0 30px #00d4ff);
    }

    .logo-dynamic.topo-esquerdo {
      top: 10px;
      left: 10px;
    }

    .logo-dynamic.topo-direito {
      top: 10px;
      right: 10px;
    }

    .logo-dynamic.ativo {
      animation: logo-fade-pulse 2s ease-in-out infinite;
    }

    @keyframes logo-fade-pulse {
      0% {
        opacity: 0.2;
        filter: brightness(1) drop-shadow(0 0 15px #00d4ff);
      }
      50% {
        opacity: 0.6;
        filter: brightness(2) drop-shadow(0 0 40px #00ffff);
      }
      100% {
        opacity: 0.2;
        filter: brightness(1) drop-shadow(0 0 15px #00d4ff);
      }
    }

    /* ============= HEADER ============= */
    .martelo-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      width: 100%;
      z-index: 10;
      position: relative;
    }

    .btn-voltar {
      background: rgba(0, 212, 255, 0.2);
      border: 2px solid #00d4ff;
      color: #00d4ff;
      padding: 0.75rem 1.5rem;
      font-size: 1rem;
      border-radius: 0.5rem;
      cursor: pointer;
      transition: all 0.3s ease;
      text-transform: uppercase;
      font-weight: bold;
      letter-spacing: 1px;
    }

    .btn-voltar:hover {
      background: rgba(0, 212, 255, 0.4);
      transform: scale(1.05);
      box-shadow: 0 0 20px rgba(0, 212, 255, 0.6);
    }

    .martelo-titulo {
      font-size: 3.5rem;
      font-weight: bold;
      text-shadow: 0 0 20px #00d4ff, 0 0 40px #0099ff;
      animation: slideInDown 0.8s ease-out, pulse-title 2s infinite 0.8s;
      color: #00ffff;
      letter-spacing: 3px;
    }

    @keyframes pulse-title {
      0%, 100% {
        text-shadow: 0 0 20px #00d4ff, 0 0 40px #0099ff;
      }
      50% {
        text-shadow: 0 0 30px #00ffff, 0 0 60px #00d4ff, 0 0 90px #0099ff;
      }
    }

    .martelo-info {
      font-size: 1.3rem;
      color: #00ffff;
      font-weight: bold;
      letter-spacing: 2px;
    }

    /* ============= AREA CENTRAL ============= */
    .martelo-content {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      flex: 1;
      gap: 2rem;
      width: 100%;
      position: relative;
      z-index: 5;
    }

    /* ============= MARCAS DE FAIXA ============= */
    .marcas-container {
      width: 100%;
      max-width: 800px;
      display: flex;
      justify-content: space-around;
      gap: 1rem;
      margin-bottom: 1rem;
      flex-wrap: wrap;
    }

    .marca {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background: rgba(0, 212, 255, 0.2);
      border: 2px solid rgba(0, 212, 255, 0.4);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.75rem;
      font-weight: bold;
      color: #00d4ff;
      transition: all 0.3s ease;
    }

    .marca.desbloqueado {
      background: #00ffff;
      border-color: #00ff00;
      box-shadow: 0 0 20px #00ffff, 0 0 40px #00ff00;
      animation: marca-pisca 0.5s ease-out;
    }

    @keyframes marca-pisca {
      0% {
        transform: scale(0.3);
        opacity: 0;
        box-shadow: 0 0 10px #00ffff;
      }
      40% {
        transform: scale(1.4);
        box-shadow: 0 0 40px #ffff00, 0 0 80px #ff00ff;
      }
      100% {
        transform: scale(1);
        opacity: 1;
        box-shadow: 0 0 20px #00ffff, 0 0 40px #00ff00;
      }
    }

    /* ============= BARRA DE FOR√áA ============= */
    .martelo-barra-container {
      width: 100%;
      max-width: 700px;
      display: flex;
      flex-direction: column;
      gap: 2rem;
      align-items: center;
    }

    .martelo-stats {
      display: flex;
      justify-content: space-around;
      width: 100%;
      font-size: 1.3rem;
      gap: 1rem;
      flex-wrap: wrap;
    }

    .martelo-stat-item {
      background: rgba(0, 212, 255, 0.1);
      padding: 1.2rem;
      border-radius: 0.75rem;
      border: 2px solid #00d4ff;
      text-align: center;
      min-width: 130px;
      backdrop-filter: blur(10px);
      box-shadow: 0 0 15px rgba(0, 212, 255, 0.3);
    }

    .martelo-stat-label {
      font-size: 0.85rem;
      opacity: 0.8;
      text-transform: uppercase;
      letter-spacing: 1.5px;
      color: #00ffff;
    }

    .martelo-stat-valor {
      font-size: 2.2rem;
      font-weight: bold;
      margin-top: 0.5rem;
      color: #00ff00;
      text-shadow: 0 0 10px #00ff00;
    }

    .martelo-barra-forca {
      width: 100%;
      height: 120px;
      background: rgba(0, 0, 0, 0.6);
      border-radius: 1rem;
      overflow: hidden;
      border: 3px solid #00d4ff;
      position: relative;
      box-shadow: 0 0 30px rgba(0, 212, 255, 0.5), inset 0 0 20px rgba(0, 212, 255, 0.1);
    }

    .martelo-barra-fill {
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, 
        #ff0000 0%, 
        #ff5500 20%, 
        #ffaa00 40%, 
        #ffff00 60%, 
        #00ff00 80%, 
        #00ffff 100%);
      transition: width 0.05s linear;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2.5rem;
      font-weight: bold;
      color: #000;
      text-shadow: 0 2px 8px rgba(0, 0, 0, 0.8);
      position: relative;
      box-shadow: inset 0 0 30px rgba(255, 255, 255, 0.3);
    }

    .martelo-barra-fill::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
      animation: shine 0.8s infinite;
    }

    .martelo-barra-percentual {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 3rem;
      font-weight: bold;
      color: white;
      text-shadow: 0 0 20px #00d4ff, 2px 2px 8px rgba(0, 0, 0, 0.9);
      z-index: 2;
    }

    /* ============= BANNERS DE FAIXAS ============= */
    .martelo-banners {
      display: flex;
      gap: 1rem;
      flex-wrap: wrap;
      justify-content: center;
      min-height: 60px;
    }

    .martelo-banner {
      padding: 1rem 1.5rem;
      border-radius: 0.75rem;
      font-weight: bold;
      font-size: 1.1rem;
      opacity: 0;
      transform: scale(0) rotateY(90deg);
      transition: all 0.3s ease-out;
      backdrop-filter: blur(10px);
      border: 2px solid;
      text-transform: uppercase;
      letter-spacing: 1px;
      animation: none;
    }

    .martelo-banner.ativo {
      opacity: 1;
      transform: scale(1) rotateY(0deg);
      animation: pulse-banner-epic 0.5s ease-out;
    }

    @keyframes pulse-banner-epic {
      0% {
        transform: scale(0.3) rotateY(90deg);
        opacity: 0;
      }
      50% {
        transform: scale(1.1) rotateY(0deg);
      }
      100% {
        transform: scale(1) rotateY(0deg);
        opacity: 1;
      }
    }

    .banner-5kg {
      background: rgba(0, 150, 255, 0.8);
      border-color: #0096ff;
      box-shadow: 0 0 15px rgba(0, 150, 255, 0.6);
      animation: banner-pulse-5kg 0.6s ease infinite;
    }

    .banner-10kg {
      background: rgba(100, 200, 255, 0.8);
      border-color: #64c8ff;
      box-shadow: 0 0 15px rgba(100, 200, 255, 0.6);
      animation: banner-pulse-10kg 0.6s ease infinite;
    }

    .banner-15kg {
      background: rgba(0, 255, 150, 0.8);
      border-color: #00ff96;
      box-shadow: 0 0 15px rgba(0, 255, 150, 0.6);
      animation: banner-pulse-15kg 0.6s ease infinite;
    }

    .banner-20kg {
      background: rgba(255, 255, 0, 0.8);
      border-color: #ffff00;
      box-shadow: 0 0 15px rgba(255, 255, 0, 0.6);
      color: #000;
      animation: banner-pulse-20kg 0.6s ease infinite;
    }

    .banner-30kg {
      background: rgba(255, 150, 0, 0.8);
      border-color: #ff9600;
      box-shadow: 0 0 15px rgba(255, 150, 0, 0.6);
      animation: banner-pulse-30kg 0.6s ease infinite;
    }

    .banner-40kg {
      background: rgba(255, 0, 0, 0.8);
      border-color: #ff0000;
      box-shadow: 0 0 15px rgba(255, 0, 0, 0.6);
      animation: banner-pulse-40kg 0.5s ease infinite;
    }

    .banner-50kg {
      background: linear-gradient(135deg, #ff0000, #ff00ff);
      border-color: #ff00ff;
      box-shadow: 0 0 20px rgba(255, 0, 255, 0.8);
      animation: banner-pulse-50kg 0.3s ease infinite;
    }

    @keyframes banner-pulse-5kg {
      0%, 100% { box-shadow: 0 0 15px rgba(0, 150, 255, 0.6); }
      50% { box-shadow: 0 0 30px rgba(0, 150, 255, 1); }
    }

    @keyframes banner-pulse-10kg {
      0%, 100% { box-shadow: 0 0 15px rgba(100, 200, 255, 0.6); }
      50% { box-shadow: 0 0 30px rgba(100, 200, 255, 1); }
    }

    @keyframes banner-pulse-15kg {
      0%, 100% { box-shadow: 0 0 15px rgba(0, 255, 150, 0.6); }
      50% { box-shadow: 0 0 30px rgba(0, 255, 150, 1); }
    }

    @keyframes banner-pulse-20kg {
      0%, 100% { box-shadow: 0 0 15px rgba(255, 255, 0, 0.6); }
      50% { box-shadow: 0 0 30px rgba(255, 255, 0, 1); }
    }

    @keyframes banner-pulse-30kg {
      0%, 100% { box-shadow: 0 0 15px rgba(255, 150, 0, 0.6); }
      50% { box-shadow: 0 0 30px rgba(255, 150, 0, 1); }
    }

    @keyframes banner-pulse-40kg {
      0%, 100% { box-shadow: 0 0 15px rgba(255, 0, 0, 0.6); }
      50% { box-shadow: 0 0 40px rgba(255, 0, 0, 1); }
    }

    @keyframes banner-pulse-50kg {
      0%, 100% { box-shadow: 0 0 20px rgba(255, 0, 255, 0.8); }
      50% { box-shadow: 0 0 50px rgba(255, 0, 255, 1); }
    }

    /* ============= BOT√ÉO PRINCIPAL ============= */
    .martelo-botao-area {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 2rem;
      position: relative;
      z-index: 10;
    }

    .martelo-botao {
      padding: 2.5rem 4rem;
      font-size: 1.8rem;
      font-weight: bold;
      border: 3px solid #00ffff;
      border-radius: 1rem;
      cursor: pointer;
      background: linear-gradient(135deg, #0099ff, #00d4ff);
      color: black;
      transition: all 0.3s ease;
      box-shadow: 0 0 30px rgba(0, 212, 255, 0.8);
      text-transform: uppercase;
      letter-spacing: 2px;
    }

    .martelo-botao:hover:not(:disabled) {
      transform: scale(1.15);
      box-shadow: 0 0 50px rgba(0, 212, 255, 1);
      border-color: #00ff00;
    }

    .martelo-botao:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .martelo-contador {
      font-size: 5rem;
      font-weight: bold;
      text-shadow: 0 0 30px #00d4ff, 0 0 60px #0099ff;
      animation: slideInUp 0.5s ease-out;
      color: #00ffff;
      letter-spacing: 2px;
    }

    /* ============= MENSAGEM FINAL ============= */
    .martelo-mensagem {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(0);
      background: linear-gradient(135deg, #0099ff, #00d4ff);
      padding: 3rem;
      border-radius: 2rem;
      text-align: center;
      z-index: 1000;
      max-width: 500px;
      box-shadow: 0 0 50px rgba(0, 212, 255, 0.8);
      border: 3px solid #00ffff;
      animation: showMensagem 0.6s ease-out forwards;
    }

    .martelo-mensagem h2 {
      font-size: 3rem;
      margin-bottom: 1rem;
      text-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
    }

    .martelo-mensagem p {
      font-size: 1.5rem;
      margin-bottom: 1rem;
    }

    .martelo-mensagem .valor-final {
      font-size: 3.5rem;
      font-weight: bold;
      color: #ffff00;
      animation: slideInUp 0.6s ease-out 0.3s both;
      text-shadow: 0 0 20px #ffff00;
    }

    .martelo-mensagem .btn-fechar {
      margin-top: 1.5rem;
      padding: 1rem 2.5rem;
      font-size: 1.2rem;
      background: #00ff00;
      color: #000;
      border: none;
      border-radius: 0.75rem;
      cursor: pointer;
      font-weight: bold;
      animation: slideInUp 0.6s ease-out 0.6s both;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .martelo-mensagem .btn-fechar:hover {
      transform: scale(1.1);
      box-shadow: 0 0 20px rgba(0, 255, 0, 0.8);
    }

    /* ============= ANIMA√á√ïES ============= */
    @keyframes slideInDown {
      from {
        opacity: 0;
        transform: translateY(-50px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes slideInUp {
      from {
        opacity: 0;
        transform: translateY(50px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes shine {
      0% {
        left: -100%;
      }
      100% {
        left: 100%;
      }
    }

    @keyframes showMensagem {
      0% {
        opacity: 0;
        transform: translate(-50%, -50%) scale(0);
      }
      100% {
        opacity: 1;
        transform: translate(-50%, -50%) scale(1);
      }
    }

    @keyframes vibrar {
      0%, 100% {
        transform: translateX(0);
      }
      25% {
        transform: translateX(-10px);
      }
      75% {
        transform: translateX(10px);
      }
    }

    .vibrar {
      animation: vibrar 0.4s ease;
    }

    /* ============= RESPONSIVIDADE ============= */
    @media (max-width: 768px) {
      .container-fullscreen {
        padding: 1rem;
      }

      .martelo-titulo {
        font-size: 2.2rem;
      }

      .martelo-botao {
        padding: 1.5rem 2.5rem;
        font-size: 1.3rem;
      }

      .martelo-contador {
        font-size: 3.5rem;
      }

      .martelo-barra-forca {
        height: 90px;
      }

      .martelo-stat-item {
        min-width: 110px;
        padding: 0.8rem;
      }

      .martelo-stat-valor {
        font-size: 1.5rem;
      }

      .marca {
        width: 40px;
        height: 40px;
        font-size: 0.6rem;
      }
    }

    @media (max-width: 480px) {
      .martelo-titulo {
        font-size: 1.8rem;
      }

      .martelo-botao {
        padding: 1rem 1.5rem;
        font-size: 1rem;
      }

      .martelo-contador {
        font-size: 2.5rem;
      }

      .martelo-barra-forca {
        height: 70px;
      }

      .martelo-stat-item {
        min-width: 90px;
        padding: 0.6rem;
        font-size: 0.9rem;
      }

      .marca {
        width: 35px;
        height: 35px;
        font-size: 0.5rem;
      }
    }
  </style>
</head>

<body>
  <div class="raios-fundo" id="raiosFundo"></div>

  <div class="logos-container" id="logosContainer"></div>

  <div class="container-fullscreen">
    <!-- HEADER -->
    <div class="martelo-header">
      <button class="btn-voltar" onclick="voltarAbaMartelo()">‚Üê Voltar</button>
      <div class="martelo-info" id="nomeJogadorDisplay">‚ö° THOR</div>
    </div>

    <!-- CONTE√öDO CENTRAL -->
    <div class="martelo-content">
      <h1 class="martelo-titulo">‚ö° MARTELO DO THOR ‚ö°</h1>

      <!-- MARCAS DE FAIXA -->
      <div class="marcas-container" id="marcasContainer"></div>

      <!-- STATS -->
      <div class="martelo-barra-container">
        <div class="martelo-stats">
          <div class="martelo-stat-item">
            <div class="martelo-stat-label">üí™ For√ßa</div>
            <div class="martelo-stat-valor" id="forcaAtualFS">0 kg</div>
          </div>
          <div class="martelo-stat-item">
            <div class="martelo-stat-label">‚ö° M√°xima</div>
            <div class="martelo-stat-valor" id="forcaMaximaFS">0 kg</div>
          </div>
          <div class="martelo-stat-item">
            <div class="martelo-stat-label">‚è±Ô∏è Tempo</div>
            <div class="martelo-stat-valor" id="tempoFS">5s</div>
          </div>
        </div>

        <!-- BARRA DE FOR√áA -->
        <div class="martelo-barra-forca">
          <div class="martelo-barra-fill" id="barraFor√ßaFill"></div>
          <div class="martelo-barra-percentual" id="percentualFS">0%</div>
        </div>

        <!-- BANNERS -->
        <div class="martelo-banners" id="bannersContainer"></div>
      </div>
    </div>

    <!-- FOOTER -->
    <div class="martelo-botao-area">
      <div class="martelo-contador" id="contadorTempo">üéØ</div>
      <button class="martelo-botao" id="botaoTeste" onclick="iniciarTesteFullscreen()">‚ö° APERTE AGORA! ‚ö°</button>
    </div>
  </div>

  <!-- MENSAGEM FINAL -->
  <div class="martelo-mensagem" id="mensagemFinal">
    <h2 id="titulo-mensagem">üèÜ RESULTADO</h2>
    <p id="texto-mensagem">---</p>
    <div class="valor-final" id="valor-final">0 kg</div>
    <button class="btn-fechar" onclick="fecharMensagemFinal()">‚ö° CONCLUIR ‚ö°</button>
  </div>

  <script>
    let testeEmAndamento = false;
    let forcaAtualFS = 0;
    let forcaMaximaAtualFS = 0;
    let tempoRestante = 5;
    let unidadeAtualFS = 'kgf';
    let nomeJogadorFS = '';
    let fatorConversao = 101.972;

    const FAIXAS_PESO = [5, 10, 15, 20, 30, 40, 50];
    let faixasAcionadas = new Set();
    let marcasDesbloquedas = new Set();

    window.addEventListener('load', () => {
      inicializarFullscreen();
      criarMarcas();
      criarLogos();
      requestAnimationFrame(criarRaiosContinuos);
    });

    function inicializarFullscreen() {
      nomeJogadorFS = localStorage.getItem('martelo_nome_jogador') || 'Jogador';
      document.getElementById('nomeJogadorDisplay').textContent = `‚ö° ${nomeJogadorFS.toUpperCase()} ‚ö°`;

      try {
        if (window.opener && window.opener.document) {
          window.opener.document.addEventListener('forca-atualizada', (e) => {
            // Atualizar SEMPRE, n√£o apenas durante teste
            forcaAtualFS = e.detail.forcaN;
            atualizarDisplayFor√ßaSempre();
            
            // Se teste em andamento, fazer updates adicionais
            if (testeEmAndamento) {
              atualizarDisplayFor√ßa();
            }
          });

          window.opener.document.addEventListener('unidade-alterada', (e) => {
            unidadeAtualFS = e.detail.unidade;
            atualizarFatorConversao();
          });
        }
      } catch (e) {
        console.warn('‚ö† Conex√£o com janela pai limitada');
      }

      // Polling cont√≠nuo tamb√©m
      const pollingInterval = setInterval(() => {
        try {
          if (window.opener && window.opener.forcaAtual !== undefined) {
            forcaAtualFS = window.opener.forcaAtual;
            atualizarDisplayFor√ßaSempre();
            
            if (testeEmAndamento) {
              atualizarDisplayFor√ßa();
            }
          }
        } catch (e) { }
      }, 50);
    }

    function atualizarDisplayFor√ßaSempre() {
      const kg = obterValorFor√ßaExibido(forcaAtualFS);
      document.getElementById('forcaAtualFS').textContent = `${kg} kg`;
    }

    function criarMarcas() {
      const container = document.getElementById('marcasContainer');
      FAIXAS_PESO.forEach(faixa => {
        const marca = document.createElement('div');
        marca.className = 'marca';
        marca.id = `marca-${faixa}`;
        marca.textContent = `${faixa}kg`;
        container.appendChild(marca);
      });
    }

    function criarLogos() {
      const container = document.getElementById('logosContainer');
      const logos = [
        { src: 'logo_compSteam.png', classe: 'topo-esquerdo' },
        { src: 'logo_receita.png', classe: 'topo-direito' }
      ];

      logos.forEach((logo) => {
        const img = document.createElement('img');
        img.src = logo.src;
        img.className = `logo-dynamic ${logo.classe}`;
        img.onerror = () => console.warn(`Logo n√£o carregada: ${logo.src}`);
        container.appendChild(img);
      });
    }

    function atualizarFatorConversao() {
      switch (unidadeAtualFS) {
        case 'gf': fatorConversao = 101.9716; break;
        case 'kgf': fatorConversao = 101.9716; break;
        default: fatorConversao = 1;
      }
    }

    function obterValorFor√ßaExibido(valorN) {
      // Converte N para kgf: N * (9.80665 / 9.80665) = N / 9.80665 ‚âà kgf
      // Ou: N / 101.9716 * 101.9716 = N
      // Correto: kgf = N / 9.80665
      const valor = valorN / 9.80665; // Convers√£o correta de Newton para kgf
      return valor.toFixed(2);
    }

    function iniciarTesteFullscreen() {
      if (testeEmAndamento) return;

      testeEmAndamento = true;
      forcaMaximaAtualFS = 0;
      tempoRestante = 5;
      faixasAcionadas.clear();
      marcasDesbloquedas.clear();
      document.getElementById('botaoTeste').disabled = true;
      document.getElementById('contadorTempo').textContent = '5';
      document.getElementById('bannersContainer').innerHTML = '';

      // Ativar logos
      document.querySelectorAll('.logo-dynamic').forEach(logo => {
        logo.classList.add('ativo');
      });

      const intervalo = setInterval(() => {
        tempoRestante--;
        document.getElementById('contadorTempo').textContent = tempoRestante;

        if (tempoRestante <= 0) {
          clearInterval(intervalo);
          encerrarTesteFullscreen();
        }
      }, 1000);
    }

    function atualizarDisplayFor√ßa() {
      if (forcaAtualFS > forcaMaximaAtualFS) {
        forcaMaximaAtualFS = forcaAtualFS;
        const kg = obterValorFor√ßaExibido(forcaMaximaAtualFS);
        document.getElementById('forcaMaximaFS').textContent = `${kg} kg`;
      }

      const kg = obterValorFor√ßaExibido(forcaAtualFS);
      document.getElementById('forcaAtualFS').textContent = `${kg} kg`;

      const percentual = Math.min((forcaAtualFS / 5000) * 100, 100);
      document.getElementById('barraFor√ßaFill').style.width = percentual + '%';
      document.getElementById('percentualFS').textContent = Math.round(percentual) + '%';

      atualizarBannersEtapas(forcaMaximaAtualFS);
      verificarMarcasEDesbloquear(forcaMaximaAtualFS);
      verificarEDispararRaios(forcaMaximaAtualFS);

      if (forcaMaximaAtualFS > 4000) {
        document.querySelector('.container-fullscreen').classList.add('vibrar');
        setTimeout(() => {
          document.querySelector('.container-fullscreen').classList.remove('vibrar');
        }, 400);
      }
    }

    function verificarMarcasEDesbloquear(forcaKg) {
      FAIXAS_PESO.forEach(faixa => {
        if (forcaKg >= faixa && !marcasDesbloquedas.has(faixa)) {
          marcasDesbloquedas.add(faixa);
          desbloquearMarca(faixa);
        }
      });
    }

    function desbloquearMarca(faixa) {
      const marca = document.getElementById(`marca-${faixa}`);
      if (marca) {
        marca.classList.add('desbloqueado');
        setTimeout(() => {
          marca.classList.remove('desbloqueado');
        }, 700);
      }
    }

    function atualizarBannersEtapas(forcaKg) {
      const container = document.getElementById('bannersContainer');
      container.innerHTML = '';

      const faixas = [
        { kg: 5, texto: 'üí™ 5kg', classe: 'banner-5kg' },
        { kg: 10, texto: '‚ö° 10kg', classe: 'banner-10kg' },
        { kg: 15, texto: 'üî• 15kg', classe: 'banner-15kg' },
        { kg: 20, texto: 'üíõ 20kg', classe: 'banner-20kg' },
        { kg: 30, texto: 'üî• 30kg', classe: 'banner-30kg' },
        { kg: 40, texto: 'üå™Ô∏è 40kg', classe: 'banner-40kg' },
        { kg: 50, texto: 'üëë 50kg+', classe: 'banner-50kg' }
      ];

      for (let faixa of faixas) {
        if (forcaKg >= faixa.kg) {
          const banner = document.createElement('div');
          banner.className = `martelo-banner ${faixa.classe} ativo`;
          banner.textContent = faixa.texto;
          container.appendChild(banner);
        }
      }
    }

    function verificarEDispararRaios(forcaKg) {
      FAIXAS_PESO.forEach(faixa => {
        if (forcaKg >= faixa && !faixasAcionadas.has(faixa)) {
          faixasAcionadas.add(faixa);
          // MUITO MAIS raios: baseado na for√ßa da faixa
          const quantidade = 8 + Math.floor(faixa / 5);
          dispararRaios(quantidade);
        }
      });
    }

    function dispararRaios(quantidade) {
      for (let i = 0; i < quantidade; i++) {
        setTimeout(() => {
          criarRaioAnimado();
        }, i * 30);
      }
    }

    function criarRaioAnimado() {
      const container = document.getElementById('raiosFundo');
      const raio = document.createElement('div');
      raio.className = 'raio';

      const startX = Math.random() * window.innerWidth;
      const startY = Math.random() * window.innerHeight * 0.3;
      const endX = startX + (Math.random() - 0.5) * 400;
      const endY = startY + window.innerHeight * 0.5;

      raio.style.left = startX + 'px';
      raio.style.top = startY + 'px';
      raio.style.width = Math.sqrt(Math.pow(endX - startX, 2) + Math.pow(endY - startY, 2)) + 'px';
      raio.style.height = (2 + Math.random() * 8) + 'px';
      raio.style.transform = `rotate(${Math.atan2(endY - startY, endX - startX) * 180 / Math.PI}deg)`;

      container.appendChild(raio);
      raio.classList.add('ativo');

      setTimeout(() => raio.remove(), 500);
    }

    function criarRaiosContinuos() {
      if (!testeEmAndamento) {
        // Raios aleat√≥rios lentos no fundo
        if (Math.random() < 0.05) {
          criarRaioAnimado();
        }
      } else {
        // Raios MASSIVOS cont√≠nuos durante o teste
        if (Math.random() < 0.4) {
          for (let i = 0; i < (Math.random() > 0.5 ? 3 : 1); i++) {
            setTimeout(() => criarRaioAnimado(), i * 15);
          }
        }
      }
      requestAnimationFrame(criarRaiosContinuos);
    }

    function encerrarTesteFullscreen() {
      testeEmAndamento = false;
      document.getElementById('botaoTeste').disabled = false;

      // Desativar logos
      document.querySelectorAll('.logo-dynamic').forEach(logo => {
        logo.classList.remove('ativo');
      });

      registrarResultadoMarteloFS(forcaMaximaAtualFS);
      mostrarMensagemFinal(forcaMaximaAtualFS);
    }

    function registrarResultadoMarteloFS(forca) {
      try {
        const dados = JSON.parse(localStorage.getItem('martelo_do_thor_data') || '{"jogadores":{}}');

        if (!dados.jogadores[nomeJogadorFS]) {
          dados.jogadores[nomeJogadorFS] = { tentativas: [], melhor: 0, media: 0 };
        }

        const tentativa = {
          forca: forca,
          data: new Date().toLocaleString('pt-BR'),
          timestamp: Date.now()
        };

        dados.jogadores[nomeJogadorFS].tentativas.push(tentativa);
        dados.jogadores[nomeJogadorFS].melhor = Math.max(dados.jogadores[nomeJogadorFS].melhor, forca);

        const tentativas = dados.jogadores[nomeJogadorFS].tentativas;
        const soma = tentativas.reduce((acc, t) => acc + t.forca, 0);
        dados.jogadores[nomeJogadorFS].media = soma / tentativas.length;

        localStorage.setItem('martelo_do_thor_data', JSON.stringify(dados));
      } catch (e) {
        console.error('Erro ao registrar:', e);
      }
    }

    function mostrarMensagemFinal(forca) {
      const kg = obterValorFor√ßaExibido(forca);
      let titulo = 'üèÜ RESULTADO';
      let texto = '';
      let emoji = '';

      if (forca < 500) {
        texto = 'Comece devagar!';
        emoji = 'ü§î';
      } else if (forca < 1000) {
        texto = 'Bom come√ßo!';
        emoji = 'üëç';
      } else if (forca < 2000) {
        texto = 'Muito bem!';
        emoji = 'üí™';
      } else if (forca < 3500) {
        texto = 'INCR√çVEL!';
        emoji = 'üî•';
      } else if (forca < 4500) {
        texto = '√âPICO!';
        emoji = '‚ö°';
      } else {
        texto = 'LEND√ÅRIO!';
        emoji = 'üëë';
        titulo = 'üëë LEND√ÅRIO üëë';
      }

      document.getElementById('titulo-mensagem').textContent = titulo;
      document.getElementById('texto-mensagem').textContent = `${emoji} ${texto}`;
      document.getElementById('valor-final').textContent = `${kg} kg`;

      const msg = document.getElementById('mensagemFinal');
      msg.style.display = 'flex';
      msg.style.animation = 'showMensagem 0.6s ease-out';

      dispararRaios(20);
      reproduzirSomVitoriaFS();
    }

    function fecharMensagemFinal() {
      document.getElementById('mensagemFinal').style.display = 'none';
      voltarAbaMarteloSemReset();
    }

    function voltarAbaMartelo() {
      window.parent.postMessage({ acao: 'voltarMarteloDeThor' }, '*');
      setTimeout(() => window.close(), 100);
    }

    function voltarAbaMarteloSemReset() {
      window.parent.postMessage({ acao: 'voltarMarteloSemFechar' }, '*');
    }

    function reproduzirSomVitoriaFS() {
      try {
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        const frequencias = [523.25, 659.25, 783.99];
        frequencias.forEach((freq, i) => {
          const osc = audioContext.createOscillator();
          const gain = audioContext.createGain();
          osc.connect(gain);
          gain.connect(audioContext.destination);
          osc.frequency.value = freq;
          gain.gain.setValueAtTime(0.3, audioContext.currentTime);
          gain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
          osc.start(audioContext.currentTime + i * 0.1);
          osc.stop(audioContext.currentTime + i * 0.1 + 0.3);
        });
      } catch (e) { }
    }
  </script>
</body>

</html>
