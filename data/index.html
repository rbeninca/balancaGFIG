<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>balan√ßaGFIG - Sistema de Teste de Motores Foguete</title>

  <script src="apexcharts"></script>
  <link rel="stylesheet" href="estilo.css">
  <script src="script_grafico_sessao.js" defer></script>
  <script src="funcoespdf.js" defer></script>
  <script src="script.js" defer></script>
  <script src="wizard_simplificado.js" defer></script>
  <script src="burn_analysis.js" defer></script>
  <script src="martelo-do-thor.js" defer></script>
</head>

<body>
  <!-- Overlay para Contagem Regressiva -->
  <div id="countdown-overlay">
    <div style="text-align: center;">
      <p id="countdown-status" style="font-size: 2.5rem; color: white; margin-bottom: 2rem; font-weight: bold;">Gravando...</p>
      <div id="countdown-circle">
        <div id="countdown-number"></div>
        <div id="countdown-hand"></div>
      </div>
      <p id="countdown-label" style="font-size: 1.8rem; color: #e0e0e0; margin-top: 2rem; font-weight: 500;">Tempo restante</p>
    </div>
    <button id="btn-cancelar-countdown" class="btn btn-perigo">Cancelar Grava√ß√£o</button>
  </div>

  <!-- Loading Overlay para Fetch de Dados -->
  <div id="loading-overlay" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.5); z-index: 9999; flex-direction: column; align-items: center; justify-content: center;">
    <div style="background: white; padding: 2rem; border-radius: 8px; text-align: center; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);">
      <div style="display: inline-block; width: 50px; height: 50px; border: 4px solid var(--cor-primaria); border-top: 4px solid transparent; border-radius: 50%; animation: spin 1s linear infinite; margin-bottom: 1rem;"></div>
      <p style="margin: 0; color: var(--cor-texto-secundario); font-size: 0.95rem;">Carregando dados da sess√£o...</p>
      <button id="btn-fechar-loader" style="margin-top: 1rem; padding: 0.5rem 1rem; background-color: var(--cor-alerta); color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 0.9rem;">Fechar</button>
    </div>
    <style>
      @keyframes spin {
        to { transform: rotate(360deg); }
      }
    </style>
  </div>

  <div class="container">
        <div id="alerta-estabilizacao">
      ‚ö†Ô∏è A balan√ßa n√£o est√° estabilizando! A toler√¢ncia pode estar muito baixa.
      V√° em Par√¢metros ‚Üí Toler√¢ncia de Estabilidade e aumente o valor.
    </div>

    <div class="sticky-header-group">
      <div class="leituras-display">
        <div class="leituras-valores" id="leituras-container" title="Clique para alternar a unidade de medida (kgf, N, gf)" style="cursor: pointer;">
          <div title="For√ßa atual sendo medida pela c√©lula de carga em tempo real">
            <h4>For√ßa Atual</h4>
            <p id="forca-atual">---</p>
          </div>
          
          <div title="Maior for√ßa registrada desde que o gr√°fico foi limpo ou iniciado">
            <h4>For√ßa M√°xima</h4>
            <p id="forca-maxima">---</p>
            <small id="forca-minima" style="display: block; font-size: 0.75rem; color: var(--cor-texto-secundario);">m√≠n: ---</small>
          </div>
          <div title="Taxa de atualiza√ß√£o: quantas leituras a balan√ßa est√° enviando por segundo">
            <h4>Leituras/Seg</h4>
            <p id="leituras-por-segundo">---</p>
          </div>
        </div>
        
        <!-- Barra de progresso do esfor√ßo da c√©lula -->
        <div class="barra-esforco-celula" style="margin-top: 0.5rem; margin-bottom: 0.5rem;">
          <div class="barra-esforco-container">
            <div id="barra-esforco-fill" class="barra-esforco-fill">
              <span id="barra-esforco-texto" class="barra-esforco-texto">--- | 0%</span>
            </div>
            <div class="barra-esforco-marcadores" style="font-size: 0.6rem; margin-top: 1px;">
              <span class="barra-esforco-marcador" style="left: 50%;" title="In√≠cio da Zona de Aten√ß√£o">50%</span>
              <span class="barra-esforco-marcador" style="left: 70%;" title="Zona de Cuidado">70%</span>
              <span class="barra-esforco-marcador" style="left: 80%;" title="Zona de Perigo">80%</span>
              <span class="barra-esforco-marcador" style="left: 90%;" title="Zona Cr√≠tica">90%</span>
            </div>
          </div>
        </div>
      </div>

      <div class="nav-abas">
        <nav>
          <button class="tablink" onclick="abrirAba(this, 'abaGrafico')" id="padrao">üìà Gr√°fico</button>
          <button class="tablink" onclick="abrirAba(this, 'abaTabela')">üìã Tabela</button>
          <button class="tablink" onclick="abrirAba(this, 'abaGravacoes')">üíæ Grava√ß√µes</button>
          <button class="tablink" onclick="abrirAba(this, 'abaControles')">‚öôÔ∏è Par√¢metros</button>
          <button class="tablink" onclick="abrirAba(this, 'abaMartelo')">‚ö° Martelo do Thor</button>
          <button class="tablink" onclick="abrirAba(this, 'abaConexao')">üîå Conex√£o</button>
          <button class="tablink" onclick="window.open('creditos.html', '_blank')">Cr√©ditos</button>
          <button id="btn-open-wizard" class="btn-wizard" title="Assistente de configura√ß√£o da balan√ßa">üßô‚Äç‚ôÇÔ∏è Configura√ß√£o Guiada</button>
        </nav>
      </div>
    </div>
    <main>
      <div id="abaGrafico" class="tabcontent">
        <div class="controles-grafico-sessao" style="margin-bottom: 0.5rem; display: flex; flex-wrap: wrap; gap: 0.5rem;">
          <button id="btn-abrir-modal-sessao" class="btn btn-sucesso" style="font-size: 1rem; padding: 0.75rem 1.5rem;">üöÄ Nova Sess√£o de Teste</button>
          <button id="btn-encerrar-sessao" onclick="encerrarSessao()" class="btn btn-perigo" style="font-size: 1rem; padding: 0.75rem 1.5rem;" disabled>‚èπ Encerrar Sess√£o</button>
        </div>

        <!-- Mensagem de Grava√ß√£o -->
        <div id="mensagem-gravacao" style="display: none;">
          <div style="display: flex; align-items: center; gap: 0.8rem; justify-content: center;">
            <span class="record-dot"></span>
            <span id="tempo-gravacao" style="font-size: 1.8rem;">Gravando 0s...</span>
          </div>
          <span id="tempo-restante" style="display: none; font-size: 3.5rem; font-weight: bold; color: white; margin-top: 1rem;">0</span>
        </div>

        <div class="grafico-e-controles" style="display: flex; align-items: flex-start; gap: 1rem; flex-wrap: nowrap;">
          <div id="grafico" class="ct-chart" style="flex-grow: 1;"></div>
          <div class="controles-laterais" style="display: flex; flex-direction: column; gap: 0.5rem;">
            <!-- New input for MAX_DATA_POINTS -->
            <div style="display: flex; align-items: center; gap: 0.5rem; padding: 0.5rem; border: 1px solid var(--cor-borda); border-radius: 0.5rem;">
              <label for="max-data-points-input" id="max-data-points-label">Max Pontos:</label>
              <input type="number" id="max-data-points-input" value="100" min="10" step="10" style="width: 80px;" title="N√∫mero m√°ximo de pontos no modo deslizante. No modo acumulado, mostra a contagem atual.">
            </div>

            <div class="btn-grupo">
              <button id="btn-toggle-labels" class="btn" onclick="toggleDataLabels()" title="Mostrar ou ocultar os valores num√©ricos nos pontos do gr√°fico">Mostrar/Ocultar Labels</button>
              <button id="btn-toggle-display-mode" class="btn" onclick="toggleChartDisplayMode()" title="Alternar entre: somente pontos, somente linha ou pontos + linha">Modo: Somente Pontos</button>
              <button id="btn-toggle-grid" class="btn" onclick="toggleGrid()" title="Mostrar ou ocultar a grade de refer√™ncia do gr√°fico">Grade: ON</button>
              <button id="btn-set-smooth-line" class="btn" onclick="setInterpolation('smooth')" title="Linha suavizada (interpola√ß√£o cardinal) - melhor visualiza√ß√£o">Linha Suave</button>
              <button id="btn-set-straight-line" class="btn" onclick="setInterpolation('straight')" title="Linha reta entre pontos (interpola√ß√£o linear) - dados brutos">Linha Reta</button>
            </div>
            <div class="btn-grupo">
              <button id="btn-toggle-fullscreen" class="btn" onclick="toggleFullscreen()" title="Expandir gr√°fico para tela cheia (melhor visualiza√ß√£o)">Tela Cheia</button>
              <button class="btn" onclick="setYAxisRange('auto')" title="Eixo Y ajusta automaticamente aos valores exibidos">Range Autom√°tico</button>
              <button class="btn" onclick="setYAxisRange('fixed')" title="Eixo Y fixo de 0 at√© a capacidade m√°xima da c√©lula">Range Fixo (C√©lula)</button>
            </div>
            <div class="btn-grupo">
              <button id="btn-anti-noising" class="btn" onclick="toggleAntiNoising()" title="Filtro que remove ru√≠do atrav√©s de m√©dia m√≥vel exponencial">Anti-Noising: Off</button>
              <button id="btn-zona-morta" class="btn" onclick="toggleFiltroZonaMorta()" style="background: #27ae60;" title="Ignora varia√ß√µes pequenas pr√≥ximas a zero (elimina deriva)">Zona Morta: ON</button>
              <button id="btn-arredondamento" class="btn" onclick="toggleArredondamentoInteligente()" style="background: #27ae60;" title="Arredonda valores conforme a acur√°cia da c√©lula (reduz ru√≠do)">Arredondar: ON</button>
            </div>
            
            <div id="status-filtros" style="margin-top: 0.5rem; padding: 0.5rem; background: #ecf0f1; border-radius: 0.5rem; font-size: 0.875rem;">
              <strong>üìä Filtros da C√©lula:</strong>
              <span id="info-zona-morta" style="margin-left: 1rem; color: #27ae60;">‚úì Zona Morta (¬±0.0g)</span>
              <span id="info-arredondamento" style="margin-left: 1rem; color: #27ae60;">‚úì Arredondamento (0 casas)</span>
            </div>
            <div class="btn-grupo" style="flex-direction: column;">
              <button id="btn-deslizante" class="btn" onclick="setChartMode('deslizante')" title="Modo deslizante: mant√©m apenas os √∫ltimos N pontos (janela m√≥vel)">Deslizante</button>
              <button id="btn-acumulado" class="btn" onclick="setChartMode('acumulado')" title="Modo acumulado: armazena todos os pontos sem limite">Acumulado</button>
              <button id="btn-pausado" class="btn" onclick="toggleChartPause()" title="Pausar atualiza√ß√£o do gr√°fico (dados continuam sendo recebidos)">Pausar/Retomar</button>
              <button onclick="clearChart()" class="btn btn-secundario" title="Limpar todos os dados do gr√°fico e resetar valores m√°ximo/m√≠nimo">Limpar Gr√°fico</button>
            </div>
          </div>
        </div>
      </div>
      <div id="abaTabela" class="tabcontent">
        <div class="tabela-container">
          <table id="tabela">
            <thead>
              <tr>
                <th>Timestamp</th>
                <th>Tempo ESP (s)</th>
                <th>Newtons (N)</th>
                <th>Grama-for√ßa (gf)</th>
                <th>Quilo-for√ßa (kgf)</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
      <div id="abaControles" class="tabcontent">
        <section>
          <h2 style="font-size: 1.25rem; font-weight: 600; margin-bottom: 0.5rem;">
            Par√¢metros da Balan√ßa 
            <span style="font-size: 0.7rem; color: var(--cor-info); font-weight: normal; background: var(--cor-info-light); padding: 0.25rem 0.5rem; border-radius: 0.25rem;">üíæ Salvos no ESP32</span>
          </h2>
          <p style="font-size: 0.875rem; color: var(--cor-texto-secundario); margin-bottom: 1rem;">
            Estes valores s√£o armazenados na mem√≥ria do ESP32 e recuperados automaticamente ao reiniciar.
          </p>
          <div class="grid-container" style="gap: 1rem;">
            <div>
              <label for="param-conversao" title="Fator de convers√£o espec√≠fico da sua c√©lula de carga (obtido na calibra√ß√£o)">Fator de Convers√£o</label>
              <input id="param-conversao" type="number" step="any" title="Valor calibrado que converte leitura bruta em for√ßa (N). Obtido durante calibra√ß√£o.">
            </div>
            <div>
              <label for="param-gravidade" title="Acelera√ß√£o da gravidade local em m/s¬≤ (varia com altitude e latitude)">Gravidade (m/s¬≤)</label>
              <input id="param-gravidade" type="number" step="any" title="Valor padr√£o: 9.80665 m/s¬≤. Ajuste conforme sua localiza√ß√£o geogr√°fica.">
            </div>
            <div>
              <label for="param-offset" title="Offset de tara salvo permanentemente no ESP32">Offset de Tara Salvo</label>
              <input id="param-offset"
                style="padding: 0.5rem 0.75rem; background-color: #f9fafb; border: 1px solid #d1d5db; border-radius: 0.375rem;"
                readonly title="Valor de tara aplicado (somente leitura). Use Shift+T para tarar.">
            </div>
          </div>

          <h3 style="font-size: 1.125rem; font-weight: 600; margin-top: 1.5rem; margin-bottom: 0.5rem;">
            ‚öñÔ∏è Especifica√ß√µes da C√©lula de Carga
            <span style="font-size: 0.7rem; color: var(--cor-info); font-weight: normal; background: var(--cor-info-light); padding: 0.25rem 0.5rem; border-radius: 0.25rem;">üíæ Salvos no ESP32</span>
          </h3>
          <p style="font-size: 0.875rem; color: var(--cor-texto-secundario); margin-bottom: 0.75rem;">
            Configure a capacidade e precis√£o da sua c√©lula. Valores salvos na mem√≥ria n√£o-vol√°til do ESP32.
          </p>
          <div class="grid-container" style="gap: 1rem;">
            <div>
              <label for="param-capacidade-maxima" title="Capacidade m√°xima nominal da sua c√©lula de carga">Capacidade M√°xima (g)</label>
              <input id="param-capacidade-maxima" type="number" step="any" oninput="atualizarCapacidadeEmKg()" title="Ex: 5000g para c√©lula de 5kg. Usado para range fixo do gr√°fico.">
              <small id="capacidade-em-kg"
                style="color: var(--cor-texto-secundario); display: block; margin-top: 0.25rem;">‚âà 5.00 kg</small>
            </div>
            <div>
              <label for="param-acuracia" title="Precis√£o da c√©lula conforme datasheet (classe de precis√£o)">Acur√°cia (%)</label>
              <input id="param-acuracia" type="number" step="0.001" oninput="atualizarErroAbsoluto()" title="Percentual de erro da c√©lula. Ex: 0.03% = classe C3, 0.1% = classe D1">
              <small id="erro-absoluto"
                style="color: var(--cor-texto-secundario); display: block; margin-top: 0.25rem;">Erro: ¬±0.00 g</small>
              <small style="color: var(--cor-info); display: block; margin-top: 0.25rem;">
                üí° Valores t√≠picos: 0.03% a 0.1%
              </small>
            </div>
          </div>

          <h3 style="font-size: 1.125rem; font-weight: 600; margin-top: 1.5rem; margin-bottom: 0.5rem;">
            Par√¢metros de Estabiliza√ß√£o
            <span style="font-size: 0.7rem; color: var(--cor-info); font-weight: normal; background: var(--cor-info-light); padding: 0.25rem 0.5rem; border-radius: 0.25rem;">üíæ Salvos no ESP32</span>
          </h3>
          <p style="font-size: 0.875rem; color: var(--cor-texto-secundario); margin-bottom: 0.75rem;">
            Par√¢metros que controlam quando a balan√ßa considera a leitura est√°vel. Armazenados no ESP32.
          </p>
          <div class="grid-container" style="gap: 1rem;">
            <div>
              <label for="param-leituras-estaveis" title="Quantas leituras consecutivas dentro da toler√¢ncia para considerar est√°vel">Leituras Est√°veis</label>
              <input id="param-leituras-estaveis" type="number" title="N√∫mero de amostras consecutivas que devem estar dentro da toler√¢ncia. Padr√£o: 3-5">
            </div>
            <div>
              <label for="param-tolerancia" title="Varia√ß√£o m√°xima permitida entre leituras para considerar est√°vel">Toler√¢ncia de Estabilidade</label>
              <input id="param-tolerancia" type="number" step="any" oninput="atualizarToleranciaEmGramas()" title="Quanto pode variar entre leituras (em Newtons). Se n√£o estabiliza, aumente!">
              <small id="tolerancia-em-gramas"
                style="color: var(--cor-texto-secundario); display: block; margin-top: 0.25rem;">‚âà 0.00 g</small>
              <small style="color: var(--cor-aviso); display: block; margin-top: 0.25rem;">
                ‚ö†Ô∏è Se a balan√ßa n√£o estabiliza, aumente este valor!
              </small>
            </div>
            <div>
              <label for="param-num-amostras" title="Quantas leituras usar para calcular a m√©dia de estabiliza√ß√£o">N¬∫ Amostras para M√©dia</label>
              <input id="param-num-amostras" type="number" title="Quantidade de amostras para m√©dia m√≥vel. Mais amostras = mais suave, mas mais lento.">
            </div>
            <div>
              <label for="param-timeout" title="Tempo m√°ximo de espera para estabilizar durante calibra√ß√£o">Timeout de Calibra√ß√£o (ms)</label>
              <input id="param-timeout" type="number" title="Milissegundos de espera m√°xima. Se exceder, calibra√ß√£o falha. Padr√£o: 5000-10000ms">
            </div>
            <div>
              <label for="taxa-atualizacao" title="Intervalo entre atualiza√ß√µes do gr√°fico (n√£o afeta leitura da balan√ßa)">Taxa de Atualiza√ß√£o do Gr√°fico (ms)</label>
              <input id="taxa-atualizacao" type="number" min="10" max="1000" step="10" value="100" title="Intervalo em milissegundos. 100ms = 10 atualiza√ß√µes/seg. Menor = mais responsivo">
              <small id="taxa-info" style="color: var(--cor-texto-secundario); display: block; margin-top: 0.25rem;">‚âà 10 atualiza√ß√µes/seg</small>
            </div>
          </div>
          <button onclick="salvarParametros()" class="btn btn-sucesso" style="margin-top: 1.5rem;" title="Salvar todos os par√¢metros na mem√≥ria n√£o-vol√°til do ESP32">
            üíæ Salvar Todos os Par√¢metros no ESP32
          </button>
        </section>

        <section style="margin-top: 2rem; padding-top: 1.5rem; border-top: 1px solid var(--cor-borda);">
          <h3 style="font-size: 1.125rem; font-weight: 600; margin-bottom: 0.5rem;">
            üîä Configura√ß√µes de Anti-Noising
          </h3>
          <p style="font-size: 0.875rem; color: var(--cor-texto-secundario); margin-bottom: 1rem;">
            Configure a an√°lise e redu√ß√£o de ru√≠do da balan√ßa. Use <kbd>Shift+A</kbd> para iniciar an√°lise de ru√≠do.
          </p>
          
          <div class="grid-container" style="gap: 1rem;">
            <div>
              <label for="anti-noising-multiplier" title="Controla a agressividade do filtro anti-ru√≠do">Multiplicador de Threshold</label>
              <input id="anti-noising-multiplier" type="number" step="0.1" min="0.5" max="10" value="2.0" 
                     oninput="setAntiNoisingMultiplier(this.value); atualizarInfoMultiplier()"
                     title="Multiplicador do desvio padr√£o para definir o limiar de ru√≠do. 2.0x = filtro moderado, 3.0x = agressivo">
              <small id="info-multiplier" style="color: var(--cor-texto-secundario); display: block; margin-top: 0.25rem;">
                Valor atual: 2.0x desvio padr√£o
              </small>
              <small style="color: var(--cor-info); display: block; margin-top: 0.25rem;">
                üí° Valores maiores = mais agressivo na remo√ß√£o de ru√≠do
              </small>
            </div>
            
            <div>
              <label>A√ß√µes de An√°lise de Ru√≠do</label>
              <div style="display: flex; gap: 0.5rem; flex-wrap: wrap; margin-top: 0.5rem;">
                <button onclick="startNoiseAnalysis()" class="btn btn-info" 
                  title="Inicia an√°lise do ru√≠do sem carga para calcular desvio padr√£o e threshold ideal">
                  üîç Analisar Ru√≠do (Shift+A)
                </button>
                <button onclick="resetNoiseAnalysis()" class="btn btn-secundario">
                  üîÑ Resetar An√°lise
                </button>
              </div>
              <small style="color: var(--cor-texto-secundario); display: block; margin-top: 0.5rem;">
                A an√°lise leva 5 segundos com a balan√ßa vazia e est√°vel
              </small>
            </div>
          </div>
        </section>

        <div style="margin-top: 2rem; padding-top: 1.5rem; border-top: 1px solid var(--cor-borda);">
          <div class="grid-container">
            <div>
              <h3>Comando de Tara (<kbd>Shift+T</kbd>)</h3>
              <p style="font-size: 0.875rem; color: var(--cor-texto-secundario); margin-bottom: 0.75rem;">Zera a
                balan√ßa.
                Use com o prato vazio.</p><button onclick="tare()" class="btn btn-primario">Zerar (Tara)</button>
            </div>
            <div>
              <h3>Calibra√ß√£o (<kbd>Shift+C</kbd>)</h3>
              <p style="font-size: 0.875rem; color: var(--cor-texto-secundario); margin-bottom: 0.75rem;">Coloque um
                peso
                de
                massa conhecida (em gramas) e digite o valor.</p>
              <div style="display: flex; align-items: center; gap: 0.5rem;"><input id="massaCalibracao" type="number"
                  step="any" placeholder="Massa em gramas" style="width: 12rem;"><button onclick="calibrar()"
                  class="btn btn-aviso">Calibrar</button></div>
            </div>
          </div>
        </div>
      </div>
      <div id="abaGravacoes" class="tabcontent">
        <div style="display: flex; justify-content: flex-end; margin-bottom: 1rem;">
          <button onclick="abrirModalImportacao()" class="btn btn-info" style="font-size: 1rem; padding: 0.75rem 1.5rem;">
            üì• Importar Grava√ß√£o
          </button>
        </div>

        <div id="lista-gravacoes" style="display: flex; flex-direction: column; gap: 0.75rem;"></div>
      </div>

      <!-- Modal de Importa√ß√£o -->
      <div id="modal-importacao" class="wizard-modal">
        <div class="wizard-content">
          <div class="wizard-header">
            <h2>üì• Importar Grava√ß√£o</h2>
            <button class="wizard-close" onclick="fecharModalImportacao()">&times;</button>
          </div>
          <div class="wizard-body">
            <div class="wizard-step" style="display: block;">
              <div style="padding: 1rem; border: 1px dashed var(--cor-borda); border-radius: 0.5rem; margin-bottom: 1.5rem;">
                <h3 style="font-size: 1rem; font-weight: 600; margin-bottom: 0.5rem;">üì• Importar Teste Est√°tico (.txt)</h3>
                <p style="font-size: 0.75rem; color: var(--cor-texto-secundario); margin-bottom: 0.75rem;">
                  Importe arquivos de texto (ex: sa√≠das de simula√ß√£o FxT) no formato *tempo [s] for√ßa [N]*.</p>
                <input type="file" id="importar-arquivo-motor" accept=".txt,.log" style="width: auto; margin-right: 10px;" title="Selecione um arquivo .txt ou .log com dados de for√ßa ao longo do tempo">
                <input type="text" id="nome-importacao" placeholder="Nome da sess√£o importada" style="max-width: 200px;" title="Nome identificador para a sess√£o importada">
                <button onclick="importarGravacaoExterna()" class="btn btn-info" style="margin-top: 10px;" title="Processar e salvar o arquivo importado no banco de dados">
                  Salvar Importa√ß√£o
                </button>
              </div>

              <div style="padding: 1rem; border: 1px dashed var(--cor-primaria); border-radius: 0.5rem; margin-bottom: 1.5rem; background: rgba(52, 152, 219, 0.05);">
                <h3 style="font-size: 1rem; font-weight: 600; margin-bottom: 0.5rem;">üì§ Importar Grava√ß√£o Exportada (.json)</h3>
                <p style="font-size: 0.75rem; color: var(--cor-texto-secundario); margin-bottom: 0.75rem;">
                  Restaure grava√ß√µes previamente exportadas em formato JSON. Todas as informa√ß√µes da sess√£o ser√£o recuperadas.</p>
                <input type="file" id="importar-json" accept=".json,application/json" style="width: auto; margin-right: 10px;" title="Selecione um arquivo JSON exportado anteriormente desta aplica√ß√£o">
                <button onclick="importarGravacaoJSON()" class="btn btn-sucesso" style="margin-top: 10px;" title="Restaurar sess√£o completa a partir do arquivo JSON">
                  üì• Importar JSON
                </button>
              </div>
            </div>
          </div>
          <div class="wizard-footer">
            <button onclick="fecharModalImportacao()" class="btn btn-secundario">Fechar</button>
          </div>
        </div>
      </div>
        
        <hr style="border: 0; border-top: 1px solid var(--cor-borda); margin: 2rem 0;">

        
      </div>
      <div id="abaMartelo" class="tabcontent">
        <div style="text-align: center; padding: 2rem;">
          <h1 style="font-size: 2.5rem; margin-bottom: 1rem;">üéÆ COLE√á√ÉO DE JOGOS üéÆ</h1>
          <p style="font-size: 1.25rem; color: var(--cor-texto-secundario); margin-bottom: 1rem;">
            Inclui: Martelo do Thor + 8 Templates de Jogos
          </p>
          <p style="font-size: 1rem; color: var(--cor-texto-secundario); margin-bottom: 2rem;">
            Teste sua for√ßa e compita com outros jogadores em diferentes desafios! ‚ö°
          </p>
          <button onclick="abrirMarteloFullscreen()" style="
            padding: 1.5rem 3rem;
            font-size: 1.5rem;
            font-weight: bold;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 1rem;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 2px;
          " onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
            üéÆ ABRIR COLE√á√ÉO DE JOGOS
          </button>
          <p style="margin-top: 2rem; color: var(--cor-texto-secundario);">
            Selecione um jogo e comece a jogar!
          </p>
        </div>
      </div>
            <small style="display: block; color: rgba(255, 255, 255, 0.8);">For√ßa em tempo real</small>
          </div>

        </div>
      </div>
      <div id="abaConexao" class="tabcontent">
        <h2 style="font-size: 1.25rem; font-weight: 600; margin-bottom: 0.5rem;">Configura√ß√µes de Conex√£o</h2>
        <p style="font-size: 0.875rem; color: var(--cor-texto-secundario); margin-bottom: 1rem;">
          Configure o endere√ßo do servidor WebSocket para ambientes de desenvolvimento.
        </p>
        <div>
          <label for="ws-url">URL do Servidor WebSocket</label>
          <input type="text" id="ws-url" placeholder="ws://[2804:4950:1:803e:78c5:d2ff:fe30:2650]:81" title="URL completa do servidor WebSocket (ws:// para IPv4 ou IPv6 entre colchetes)">
          <span class="info-text" style="font-size: 0.85em; color: var(--cor-texto-secundario); margin-top: 0.5rem; display: block;">
            Ex: ws://seu_endereco_ipv4:81 ou ws://[seu_endereco_ipv6]:81
          </span>
        </div>
        <div id="ws-url-controls" style="display: flex; gap: 0.5rem; margin-top: 1rem;">
          <button id="btn-salvar-ws-url" onclick="salvarWsUrl()" class="btn btn-sucesso" title="Salvar URL e reconectar imediatamente ao servidor WebSocket">Salvar e Reconectar</button>
          <button id="btn-resetar-ws-url" onclick="resetarWsUrl()" class="btn btn-secundario" title="Restaurar URL padr√£o do servidor WebSocket (auto-detecta)">üîÑ Restaurar Padr√£o</button>
        </div>
      </div>
    </main>

    <!-- √çcone flutuante para toggle do rodap√© -->
    <div id="footer-toggle" title="Mostrar/Ocultar informa√ß√µes de status">
      <div class="footer-toggle-indicators">
        <div class="footer-toggle-dot" id="toggle-ws-indicator" title="WebSocket"></div>
        <div class="footer-toggle-dot" id="toggle-mysql-indicator" title="MySQL"></div>
        <div class="footer-toggle-dot" id="toggle-balanca-indicator" title="Balan√ßa"></div>
          <div class="footer-section footer-time">
        <span class="time-label" title="Hor√°rio atual do servidor (UTC-3 - America/Sao_Paulo)">üïê Servidor:</span>
        <span id="server-clock">--:--:--</span>
        <button onclick="syncServerTime()" class="btn btn-sync" title="Sincronizar rel√≥gio do servidor com a hora do seu navegador">üîÑ</button>
      </div>
      </div>
      <span class="footer-toggle-icon">‚ñº</span>
    </div>

    <footer id="footer-atalhos">
      <div class="footer-section footer-brand">
        <h3>üöÄ balan√ßaGFIG</h3>
        <p style="font-size: 0.85em; margin-top: 5px; line-height: 1.4;">
          Grupo de Foguetes do Campus Gaspar (GFIG)<br>
          CompSteam ‚Ä¢ Projeto BoxSteam<br>
          Controle e Automa√ß√£o de Eletrodom√©sticos do Cotidiano
        </p>
      </div>
      
      <div class="footer-section footer-status">
        <div class="status-item" title="Conex√£o WebSocket com o servidor Python - transmite dados da balan√ßa em tempo real">
          <span class="status-label">WebSocket:</span>
          <div id="ws-indicator" class="status-indicator" title="Desconectado"></div>
          <span id="ws-text">Desconectado</span>
        </div>
        <div class="status-item" title="Conex√£o com banco de dados MySQL - necess√°ria para salvar grava√ß√µes">
          <span class="status-label">MySQL:</span>
          <div id="mysql-indicator" class="status-indicator" title="MySQL Desconectado"></div>
          <span id="mysql-text">Desconectado</span>
        </div>
        <div class="status-item" title="Status de comunica√ß√£o da balan√ßa com o ESP32">
          <span class="status-label">‚öñÔ∏è Balan√ßa:</span>
          <span id="balanca-status">...</span>
        </div>
      </div>
      
    
      
      <div class="footer-section footer-shortcuts">
        <span class="shortcuts-title">‚ö° ATALHOS:</span>
        <div class="shortcuts-grid">
          <span class="shortcut-item"><span class="shortcut-label">Tara:</span> <kbd>Shift</kbd>+<kbd>T</kbd></span>
          <span class="shortcut-item"><span class="shortcut-label">Calibra√ß√£o:</span> <kbd>Shift</kbd>+<kbd>C</kbd></span>
          <span class="shortcut-item"><span class="shortcut-label">Ru√≠do:</span> <kbd>Shift</kbd>+<kbd>A</kbd></span>
          <span class="shortcut-item"><span class="shortcut-label">Debug:</span> <kbd>Shift</kbd>+<kbd>D</kbd></span>
          <span class="shortcut-item"><span class="shortcut-label">Pausar:</span> <kbd>P</kbd></span>
          <span class="shortcut-item"><span class="shortcut-label">Limpar:</span> <kbd>L</kbd></span>
        </div>
      </div>
      
      <div class="footer-section footer-theme">
        <button id="theme-toggle" class="btn-theme-toggle" title="Alternar tema">üåô</button>
      </div>
    </footer>

    <div id="notification-area"></div>

    <!-- Modal de Alerta de Conex√£o Serial -->
    <div id="modal-serial-warning" class="wizard-modal" style="display: none;">
      <div class="wizard-content" style="max-width: 600px;">
        <div class="wizard-header" style="background: var(--cor-alerta);">
          <h2 style="color: white; margin: 0;">‚ö†Ô∏è Problema de Conex√£o com a Balan√ßa</h2>
        </div>
        <div class="wizard-body">
          <div style="padding: 1rem; background: rgba(231, 76, 60, 0.1); border-radius: 0.5rem; margin-bottom: 1rem;">
            <p id="serial-error-message" style="font-size: 1rem; font-weight: 600; color: var(--cor-alerta); margin: 0;"></p>
          </div>

          <div style="margin-bottom: 1.5rem;">
            <h3 style="font-size: 1rem; margin-bottom: 0.5rem;">üîç Poss√≠veis causas:</h3>
            <ul style="margin-left: 1.5rem; line-height: 1.8;">
              <li><strong>Dispositivo USB n√£o conectado:</strong> Verifique se o ESP32/NodeMCU est√° conectado via USB</li>
              <li><strong>Cabo USB com problema:</strong> Teste com outro cabo USB (deve ser cabo de dados, n√£o apenas de carga)</li>
              <li><strong>Porta USB com problema:</strong> Tente conectar em outra porta USB do computador</li>
              <li><strong>Driver CH341 n√£o instalado:</strong> No Linux, o driver geralmente j√° vem instalado</li>
              <li><strong>Problemas de permiss√£o:</strong> Adicione seu usu√°rio ao grupo <code>dialout</code></li>
            </ul>
          </div>

          <div style="padding: 1rem; background: var(--cor-info-light); border-radius: 0.5rem; border-left: 4px solid var(--cor-info);">
            <h3 style="font-size: 0.9rem; margin-bottom: 0.5rem;">üí° Como resolver no Linux:</h3>
            <pre style="background: #2c3e50; color: #ecf0f1; padding: 0.75rem; border-radius: 0.25rem; overflow-x: auto; font-size: 0.85rem; margin: 0;">sudo usermod -a -G dialout $USER
sudo chmod 666 /dev/ttyUSB0</pre>
            <small style="color: var(--cor-texto-secundario); display: block; margin-top: 0.5rem;">
              Ap√≥s executar, fa√ßa logout e login novamente
            </small>
          </div>

          <div style="margin-top: 1.5rem; text-align: center;">
            <p style="font-size: 0.9rem; color: var(--cor-texto-secundario);">
              <strong id="serial-reconnect-status">Tentando reconectar automaticamente...</strong>
            </p>
          </div>
        </div>
        <div class="wizard-footer">
          <button onclick="fecharModalSerial()" class="btn btn-secundario">Fechar e Continuar Tentando</button>
        </div>
      </div>
    </div>

    <!-- Modal de Alerta de Sobrecarga da C√©lula -->
    <div id="modal-alerta-sobrecarga" class="modal-sobrecarga">
      <div class="modal-sobrecarga-content">
        <div class="modal-sobrecarga-header">
          <span class="modal-sobrecarga-icone">‚ö†Ô∏è</span>
          <h2 id="modal-sobrecarga-titulo">ATEN√á√ÉO: APROXIMANDO DO LIMITE!</h2>
        </div>
        <div class="modal-sobrecarga-body">
          <div class="modal-sobrecarga-display">
            <div class="modal-sobrecarga-valor">
              <span class="modal-sobrecarga-label">Carga Atual:</span>
              <span id="modal-sobrecarga-valor-atual" class="modal-sobrecarga-numero">---</span>
            </div>
            <div class="modal-sobrecarga-barra">
              <div id="modal-sobrecarga-barra-progresso" class="modal-sobrecarga-barra-fill"></div>
              <span id="modal-sobrecarga-percentual" class="modal-sobrecarga-percentual-texto">0%</span>
            </div>
            <div class="modal-sobrecarga-limite">
              <span class="modal-sobrecarga-label">Limite M√°ximo:</span>
              <span id="modal-sobrecarga-valor-limite" class="modal-sobrecarga-numero">---</span>
            </div>
          </div>
          <div class="modal-sobrecarga-aviso">
            <p id="modal-sobrecarga-mensagem">
              ‚ö†Ô∏è Voc√™ est√° pr√≥ximo do limite da c√©lula de carga!<br>
              <strong>RISCO DE DANOS PERMANENTES AO EQUIPAMENTO!</strong>
            </p>
            <p class="modal-sobrecarga-instrucao">
              Reduza a carga imediatamente para evitar a destrui√ß√£o da c√©lula.
            </p>
          </div>
        </div>
        <div class="modal-sobrecarga-footer">
          <button onclick="fecharModalSobrecarga()" class="btn-modal-sobrecarga-ok">
            Entendi - Fechar Alerta
          </button>
        </div>
      </div>
    </div>

    <div id="fullscreen-chart-modal" class="fullscreen-modal-overlay">
      <button id="btn-exit-fullscreen" class="btn btn-perigo" style="position: absolute; top: 30px; right: 20px; z-index: 1001;">‚úñ Sair da Tela Cheia</button>
      <!-- Chart and controls will be moved here by JavaScript -->
    </div>

    <!-- Modal Wizard de Configura√ß√£o Guiada SIMPLIFICADO -->
    <div id="wizard-modal" class="wizard-modal">
      <div class="wizard-content">
        <div class="wizard-header">
          <h2>üßô‚Äç‚ôÇÔ∏è Guia de Configura√ß√£o da C√©lula de Carga</h2>
          <button class="wizard-close" onclick="closeWizard()">&times;</button>
        </div>
        <div class="wizard-body">
          <div class="wizard-progress">
            <div class="wizard-progress-bar"></div>
          </div>

          <!-- PASSO 0: An√°lise Inicial Autom√°tica -->
          <div class="wizard-step" id="wizard-step-0">
            <h3>üìç Passo 0: Prepara√ß√£o</h3>
            <p style="font-size: 1.1rem; margin-bottom: 1.5rem;">Posicione a c√©lula de carga <strong>na vertical</strong> e <strong>sem nenhum peso</strong>.</p>

            <div style="background: var(--cor-info-light); padding: 1rem; border-radius: 0.5rem; margin-bottom: 1rem; border-left: 4px solid var(--cor-info);">
              <strong>üìä Leitura Atual:</strong>
              <div style="font-size: 2rem; font-weight: bold; color: var(--cor-primaria); margin-top: 0.5rem;" id="wizard-leitura-passo0">--- N</div>
            </div>

            <div id="wizard-analise-status" style="display: none; background: var(--cor-sucesso-light); padding: 1rem; border-radius: 0.5rem; border-left: 4px solid var(--cor-sucesso); margin-top: 1rem;">
              <p><strong>‚úÖ An√°lise Conclu√≠da!</strong></p>
              <p style="margin-top: 0.5rem;">Ru√≠do medido: <strong id="wizard-ruido-medido">---</strong> g</p>
              <p>Toler√¢ncia calculada: <strong id="wizard-tolerancia-calculada">---</strong> g</p>
            </div>

            <p style="margin-top: 1.5rem; font-size: 0.9rem; color: var(--cor-texto-secundario);">
              Ao clicar em "Avan√ßar", faremos automaticamente:<br>
              ‚Ä¢ Tara da c√©lula<br>
              ‚Ä¢ An√°lise de ru√≠do (5 segundos)<br>
              ‚Ä¢ C√°lculo autom√°tico da toler√¢ncia
            </p>
          </div>

          <!-- PASSO 1.1: Capacidade da C√©lula -->
          <div class="wizard-step" id="wizard-step-1" style="display: none;">
            <h3>‚öñÔ∏è Passo 1: Capacidade da C√©lula</h3>
            <p style="font-size: 1.1rem; margin-bottom: 1.5rem;">Informe a <strong>capacidade m√°xima</strong> da sua c√©lula de carga:</p>

            <div style="margin-bottom: 1.5rem;">
              <label for="wizard-capacidade-kg" style="font-size: 1.1rem; font-weight: 600;">Capacidade em kg:</label>
              <input type="number" id="wizard-capacidade-kg" placeholder="Ex: 5" step="0.001" style="font-size: 1.2rem; padding: 0.75rem;" oninput="wizardCalcularAcuracia()">
              <small style="display: block; margin-top: 0.5rem; color: var(--cor-texto-secundario);">
                Exemplo: Para uma c√©lula de 5kg, digite <strong>5</strong>
              </small>
            </div>

            <div id="wizard-acuracia-calculada" style="display: none; background: var(--cor-info-light); padding: 1rem; border-radius: 0.5rem; border-left: 4px solid var(--cor-info);">
              <p><strong>Acur√°cia estimada:</strong> <span id="wizard-acuracia-valor">0.02%</span></p>
              <p><strong>Erro m√°ximo:</strong> ¬±<span id="wizard-erro-maximo-valor">---</span> g</p>
            </div>
          </div>

          <!-- PASSO 1.2: Calibra√ß√£o com Peso Conhecido -->
          <div class="wizard-step" id="wizard-step-2" style="display: none;">
            <h3>üéØ Passo 2: Calibra√ß√£o</h3>
            <p style="font-size: 1.1rem; margin-bottom: 1.5rem;">Coloque um <strong>peso conhecido</strong> sobre a c√©lula:</p>

            <div style="background: var(--cor-info-light); padding: 1rem; border-radius: 0.5rem; margin-bottom: 1.5rem; border-left: 4px solid var(--cor-info);">
              <strong>üìä Leitura Atual:</strong>
              <div style="font-size: 2rem; font-weight: bold; color: var(--cor-primaria); margin-top: 0.5rem;" id="wizard-leitura-passo2">--- N</div>
            </div>

            <div style="margin-bottom: 1.5rem;">
              <label for="wizard-peso-conhecido" style="font-size: 1.1rem; font-weight: 600;">Peso do objeto (em gramas):</label>
              <input type="number" id="wizard-peso-conhecido" placeholder="Ex: 1000" step="0.1" style="font-size: 1.2rem; padding: 0.75rem;">
              <small style="display: block; margin-top: 0.5rem; color: var(--cor-texto-secundario);">
                Use pesos de 500g a 2000g para melhor resultado
              </small>
            </div>

            <div id="wizard-grafico-calibracao" style="width: 100%; height: 300px; margin-top: 1rem; display: none;"></div>

            <div id="wizard-calibracao-resultado" style="display: none; background: var(--cor-sucesso-light); padding: 1rem; border-radius: 0.5rem; border-left: 4px solid var(--cor-sucesso); margin-top: 1rem;">
              <p><strong>‚úÖ Calibra√ß√£o Conclu√≠da!</strong></p>
              <p style="margin-top: 0.5rem;">Fator de convers√£o: <strong id="wizard-fator-conversao">---</strong></p>
            </div>
          </div>

          <!-- PASSO 3: Tara Final -->
          <div class="wizard-step" id="wizard-step-3" style="display: none;">
            <h3>‚ú® Passo 3: Finaliza√ß√£o</h3>
            <p style="font-size: 1.1rem; margin-bottom: 1.5rem;"><strong>Retire o peso</strong> da c√©lula de carga.</p>

            <div style="background: var(--cor-info-light); padding: 1rem; border-radius: 0.5rem; margin-bottom: 1.5rem; border-left: 4px solid var(--cor-info);">
              <strong>üìä Leitura Atual:</strong>
              <div style="font-size: 2rem; font-weight: bold; color: var(--cor-primaria); margin-top: 0.5rem;" id="wizard-leitura-passo3">--- N</div>
            </div>

            <div id="wizard-tara-final-status" style="display: none; background: var(--cor-sucesso-light); padding: 1rem; border-radius: 0.5rem; border-left: 4px solid var(--cor-sucesso); margin-top: 1rem;">
              <p><strong>‚úÖ Tara Final Conclu√≠da!</strong></p>
            </div>

            <p style="margin-top: 1.5rem; font-size: 0.9rem; color: var(--cor-texto-secundario);">
              Ao clicar em "Avan√ßar", faremos a tara final automaticamente.
            </p>
          </div>

          <!-- PASSO 4: Conclus√£o -->
          <div class="wizard-step" id="wizard-step-4" style="display: none;">
            <h3>üéâ Configura√ß√£o Conclu√≠da!</h3>
            <p style="font-size: 1.1rem; margin-bottom: 1.5rem;">Sua balan√ßa est√° pronta para uso.</p>

            <div style="background: var(--cor-sucesso-light); padding: 1.5rem; border-radius: 0.5rem; border-left: 4px solid var(--cor-sucesso);">
              <h4 style="margin-top: 0;">üìã Resumo da Configura√ß√£o:</h4>
              <p><strong>Capacidade:</strong> <span id="wizard-resumo-capacidade">---</span> kg</p>
              <p><strong>Toler√¢ncia:</strong> ¬±<span id="wizard-resumo-tolerancia">---</span> g</p>
              <p><strong>Fator de Convers√£o:</strong> <span id="wizard-resumo-fator">---</span></p>
            </div>

            <div style="background: var(--cor-aviso-light); padding: 1rem; border-radius: 0.5rem; margin-top: 1.5rem; border-left: 4px solid var(--cor-aviso);">
              <p><strong>üí° Lembre-se:</strong> Fa√ßa uma nova tara (<kbd>Shift</kbd>+<kbd>T</kbd>) sempre que mover a c√©lula de carga.</p>
            </div>
          </div>

        </div>
        <div class="wizard-footer">
          <button id="wizard-btn-prev" onclick="wizardGoToStepSimple(-1)" class="btn btn-secundario" style="display: none;">‚óÄ Voltar</button>
          <button id="wizard-btn-next" onclick="wizardGoToStepSimple(1)" class="btn btn-primario">Avan√ßar ‚ñ∂</button>
          <button id="wizard-btn-finish" onclick="wizardFinishSimple()" class="btn btn-sucesso" style="display: none;">‚úÖ Concluir</button>
        </div>
      </div>
    </div>
  <!-- Modal de Nova Sess√£o -->
    <div id="modal-nova-sessao" class="wizard-modal">
      <div class="wizard-content" style="max-width: 1000px;">
        <div class="wizard-header" style="padding: 0.75rem 1rem;">
          <h2 style="margin: 0; font-size: 1.25rem;">üöÄ Nova Sess√£o de Teste</h2>
          <button class="wizard-close" onclick="fecharModalNovaSessao()">&times;</button>
        </div>
        <div class="wizard-body" style="padding: 1rem;">
          <div class="wizard-step" style="display: block;">
            <div style="margin-bottom: 0.75rem;">
              <label for="sessao-nome" style="margin-bottom: 0.25rem;">Nome da Sess√£o</label>
              <input type="text" id="sessao-nome" placeholder="Ex: Teste Motor XYZ v1">
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem; margin-bottom: 0.75rem; padding: 0.75rem; background: var(--cor-info-light, #e3f2fd); border-radius: 8px; border-left: 4px solid var(--cor-info, #2196f3);">
              <div>
                <label for="sessao-delay" style="font-size: 0.85rem; margin-bottom: 0.2rem; font-weight: 600;">‚è±Ô∏è Delay para Iniciar (s)</label>
                <input type="number" id="sessao-delay" value="0" min="0" step="1" style="padding: 0.4rem;" title="Tempo em segundos para aguardar antes de iniciar a grava√ß√£o">
                <small style="display: block; color: var(--cor-texto-secundario); margin-top: 0.2rem; font-size: 0.75rem;">Tempo de espera antes de iniciar</small>
              </div>
              <div>
                <label for="sessao-timer" style="font-size: 0.85rem; margin-bottom: 0.2rem; font-weight: 600;">‚è≤Ô∏è Dura√ß√£o da Grava√ß√£o (s)</label>
                <input type="number" id="sessao-timer" value="0" min="0" step="1" style="padding: 0.4rem;" title="Tempo total da grava√ß√£o. Deixe em 0 para grava√ß√£o manual">
                <small style="display: block; color: var(--cor-texto-secundario); margin-top: 0.2rem; font-size: 0.75rem;">0 = encerrar manualmente</small>
              </div>
            </div>

            <details class="collapsible-section" style="margin-top: 0.5rem;" open>
              <summary style="margin-bottom: 0.5rem;">‚öôÔ∏è Metadados do Motor (Opcional)</summary>

              <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 0.5rem; margin-bottom: 0.5rem;">
                <div>
                  <label for="sessao-meta-diametro" style="font-size: 0.85rem; margin-bottom: 0.2rem;">Di√¢metro (mm)</label>
                  <input type="number" id="sessao-meta-diametro" placeholder="50" style="padding: 0.2rem;">
                </div>
                <div>
                  <label for="sessao-meta-comprimento" style="font-size: 0.85rem; margin-bottom: 0.2rem;">Comprimento (mm)</label>
                  <input type="number" id="sessao-meta-comprimento" placeholder="200" style="padding: 0.2rem;">
                </div>
                <div>
                  <label for="sessao-meta-propelente" style="font-size: 0.85rem; margin-bottom: 0.2rem;">Propelente (g)</label>
                  <input type="number" id="sessao-meta-propelente" placeholder="150.5" style="padding: 0.2rem;">
                </div>
                <div>
                  <label for="sessao-meta-peso-total" style="font-size: 0.85rem; margin-bottom: 0.2rem;">Peso Total (g)</label>
                  <input type="number" id="sessao-meta-peso-total" placeholder="350.2" style="padding: 0.2rem;">
                </div>
              </div>

              <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 0.5rem; margin-bottom: 0.5rem;">
                <div>
                  <label for="sessao-meta-temperatura" style="font-size: 0.85rem; margin-bottom: 0.2rem;">üå°Ô∏è Temp. (¬∞C)</label>
                  <input type="number" id="sessao-meta-temperatura" placeholder="25.5" step="0.1" style="padding: 0.2rem;">
                </div>
                <div>
                  <label for="sessao-meta-umidade" style="font-size: 0.85rem; margin-bottom: 0.2rem;">üíß Umidade (%)</label>
                  <input type="number" id="sessao-meta-umidade" placeholder="65" min="0" max="100" step="0.1" style="padding: 0.2rem;">
                </div>
                <div>
                  <label for="sessao-meta-pressao" style="font-size: 0.85rem; margin-bottom: 0.2rem;">üîµ Press√£o (hPa)</label>
                  <input type="number" id="sessao-meta-pressao" placeholder="1013.25" step="0.01" style="padding: 0.2rem;">
                </div>
              </div>

              <div style="margin-bottom: 0.5rem;">
                <label for="sessao-meta-fabricante" style="font-size: 0.85rem; margin-bottom: 0.2rem;">Fabricante</label>
                <input type="text" id="sessao-meta-fabricante" placeholder="GFIG - Campus Gaspar IFSC" style="padding: 0.2rem; width: 100%;">
              </div>

              <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem;">
                <div>
                  <label for="sessao-meta-descricao" style="font-size: 0.85rem; margin-bottom: 0.2rem;">Descri√ß√£o</label>
                  <textarea id="sessao-meta-descricao" rows="2" placeholder="Breve descri√ß√£o do motor..." style="padding: 0.2rem; resize: vertical;"></textarea>
                </div>
                <div>
                  <label for="sessao-meta-observacoes" style="font-size: 0.85rem; margin-bottom: 0.2rem;">Observa√ß√µes</label>
                  <textarea id="sessao-meta-observacoes" rows="2" placeholder="Detalhes do teste..." style="padding: 0.2rem; resize: vertical;"></textarea>
                </div>
              </div>
            </details>
          </div>
        </div>
        <div class="wizard-footer" style="padding: 0.75rem 1rem;">
          <button onclick="fecharModalNovaSessao()" class="btn btn-secundario">Cancelar</button>
          <button onclick="iniciarSessaoAvancado()" class="btn btn-sucesso">‚ñ∂ Iniciar Grava√ß√£o</button>
        </div>
      </div>
    </div>

    <!-- Modal de Visualiza√ß√£o de Queima -->
    <div id="modal-burn-analysis" class="wizard-modal" style="display: none;">
      <div class="wizard-content" style="max-width: 90%; max-height: 95vh;">
        <div class="wizard-header" style="padding: 0.3rem 0.5rem;">
          <h2 style="margin: 0; font-size: 0.95rem;">üî• <span id="burn-modal-session-name"></span>    <button onclick="resetBurnPoints()" class="btn btn-secundario">üîÑ Resetar para Detec√ß√£o Autom√°tica
            </button>  <button onclick="fecharModalBurnAnalysis()" class="btn btn-secundario" style="flex: 1; padding: 0.3rem; font-size: 0.75rem;">Cancelar</button>
          <button onclick="salvarPontosQueima()" class="btn btn-sucesso" style="flex: 1; padding: 0.3rem; font-size: 0.75rem;">üíæ Salvar</button>
              <p style="color: var(--cor-texto-secundario); font-size: 0.75rem; margin: 0;"></p></h2>
          <button class="wizard-close" onclick="fecharModalBurnAnalysis()" style="font-size: 1.2rem; padding: 0.2rem 0.4rem;">&times;</button>
        </div>
        <div class="wizard-body">
          

          <div style="margin-bottom: 1rem; padding: 0.75rem; background: var(--cor-fundo-secundario); border-radius: 8px; border: 2px solid var(--cor-primaria);">
            
            
            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 0.2rem;">
              
              <div>
                <div style="background: var(--cor-primaria); color: white; padding: 0.4rem 0.5rem; border-radius: 4px 4px 0 0; font-weight: bold; font-size: 0.8rem;">
                  üìÖ Teste Est√°tico (Completo)
                </div>
                <table style="width: 100%; border-collapse: collapse; background: white; border: 1px solid var(--cor-borda); font-size: 0.75rem;">
                  <tr style="border-bottom: 1px solid var(--cor-borda);">
                    <td style="padding: 0.3rem 0.4rem; width: 50%;"><strong>Hor√°rio</strong></td>
                    <td style="padding: 0.3rem 0.4rem; width: 50%; text-align: right;"><strong>Tempo</strong></td>
                  </tr>
                  <tr style="background: rgba(52, 152, 219, 0.05); border-bottom: 1px solid var(--cor-borda);">
                    <td style="padding: 0.3rem 0.4rem; font-family: monospace; font-size: 0.7rem;" id="burn-test-start-time-absolute">---</td>
                    <td style="padding: 0.3rem 0.4rem; font-family: monospace; font-weight: bold; color: var(--cor-primaria); text-align: right; font-size: 0.7rem;">00:00.000s</td>
                  </tr>
                  <tr style="background: rgba(52, 152, 219, 0.05);">
                    <td style="padding: 0.3rem 0.4rem; font-family: monospace; font-size: 0.7rem;" id="burn-test-end-time-absolute">---</td>
                    <td style="padding: 0.3rem 0.4rem; font-family: monospace; font-weight: bold; color: var(--cor-primaria); text-align: right; font-size: 0.7rem;" id="burn-test-end-time-relative">---</td>
                  </tr>
                </table>
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 0.3rem; margin-top: 0.4rem;">
                  <div style="background: white; padding: 0.3rem; border: 1px solid var(--cor-borda); border-radius: 3px; text-align: center;">
                    <div style="font-size: 0.65rem; color: var(--cor-texto-secundario);">DURA√á√ÉO</div>
                    <div style="font-size: 0.8rem; font-weight: bold; color: var(--cor-primaria);" id="burn-test-duration">---</div>
                  </div>
                  <div style="background: white; padding: 0.3rem; border: 1px solid var(--cor-borda); border-radius: 3px; text-align: center;">
                    <div style="font-size: 0.65rem; color: var(--cor-texto-secundario);">LEITURAS</div>
                    <div style="font-size: 0.8rem; font-weight: bold; color: var(--cor-primaria);" id="burn-test-total-readings">---</div>
                  </div>
                  <div style="background: white; padding: 0.3rem; border: 1px solid var(--cor-borda); border-radius: 3px; text-align: center;">
                    <div style="font-size: 0.65rem; color: var(--cor-texto-secundario);">FREQ</div>
                    <div style="font-size: 0.8rem; font-weight: bold; color: var(--cor-primaria);" id="burn-test-readings-per-sec">---</div>
                  </div>
                </div>
              </div>

              <div>
                <div style="background: var(--cor-sucesso); color: white; padding: 0.4rem 0.5rem; border-radius: 4px 4px 0 0; font-weight: bold; font-size: 0.8rem;">
                  üî• Queima Detectada
                </div>
                <table style="width: 100%; border-collapse: collapse; background: white; border: 1px solid var(--cor-borda); font-size: 0.75rem;">
                  <tr style="border-bottom: 1px solid var(--cor-borda);">
                    <td style="padding: 0.3rem 0.4rem; width: 50%;"><strong>Hor√°rio</strong></td>
                    <td style="padding: 0.3rem 0.4rem; width: 50%; text-align: right;"><strong>Tempo</strong></td>
                  </tr>
                  <tr style="background: rgba(39, 174, 96, 0.05); border-bottom: 1px solid var(--cor-borda);">
                    <td style="padding: 0.3rem 0.4rem; font-family: monospace; font-size: 0.7rem;" id="burn-detected-start-time-absolute">---</td>
                    <td style="padding: 0.3rem 0.4rem; font-family: monospace; font-weight: bold; color: var(--cor-sucesso); text-align: right; font-size: 0.7rem;" id="burn-detected-start-time-relative">---</td>
                  </tr>
                  <tr style="background: rgba(39, 174, 96, 0.05);">
                    <td style="padding: 0.3rem 0.4rem; font-family: monospace; font-size: 0.7rem;" id="burn-detected-end-time-absolute">---</td>
                    <td style="padding: 0.3rem 0.4rem; font-family: monospace; font-weight: bold; color: var(--cor-sucesso); text-align: right; font-size: 0.7rem;" id="burn-detected-end-time-relative">---</td>
                  </tr>
                </table>
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 0.3rem; margin-top: 0.4rem;">
                  <div style="background: white; padding: 0.3rem; border: 1px solid var(--cor-borda); border-radius: 3px; text-align: center;">
                    <div style="font-size: 0.65rem; color: var(--cor-texto-secundario);">DURA√á√ÉO</div>
                    <div style="font-size: 0.8rem; font-weight: bold; color: var(--cor-sucesso);" id="burn-detected-duration">---</div>
                  </div>
                  <div style="background: white; padding: 0.3rem; border: 1px solid var(--cor-borda); border-radius: 3px; text-align: center;">
                    <div style="font-size: 0.65rem; color: var(--cor-texto-secundario);">LEITURAS</div>
                    <div style="font-size: 0.8rem; font-weight: bold; color: var(--cor-sucesso);" id="burn-detected-total-readings">---</div>
                  </div>
                  <div style="background: white; padding: 0.3rem; border: 1px solid var(--cor-borda); border-radius: 3px; text-align: center;">
                    <div style="font-size: 0.65rem; color: var(--cor-texto-secundario);">FREQ</div>
                    <div style="font-size: 0.8rem; font-weight: bold; color: var(--cor-sucesso);" id="burn-detected-readings-per-sec">---</div>
                  </div>
                </div>
              </div>

              <div>
                <div style="background: var(--cor-primaria); color: white; padding: 0.4rem 0.5rem; border-radius: 4px 4px 0 0; font-weight: bold; font-size: 0.8rem;">
                  üìä M√©tricas da Queima
                </div>
                <div style="background: white; border: 1px solid var(--cor-borda); border-radius: 0 0 4px 4px; padding: 0.4rem; font-size: 0.75rem;">
                  <div style="padding: 0.3rem 0; border-bottom: 1px solid rgba(52, 152, 219, 0.2);">
                    <span style="font-size: 0.65rem; color: var(--cor-texto-secundario); margin-bottom: 0.2rem;">Dura√ß√£o</span>
                    <span style="font-weight: bold; color: var(--cor-primaria); font-size: 0.85rem;" id="burn-duration-display">---</span>
                  </div>
                  <div style="padding: 0.3rem 0; border-bottom: 1px solid rgba(52, 152, 219, 0.2);">
                    <span style="font-size: 0.65rem; color: var(--cor-texto-secundario); margin-bottom: 0.2rem;">Impulso Total</span>
                    <span style="font-weight: bold; color: var(--cor-primaria); font-size: 0.85rem;" id="burn-impulse-display">---</span>
                  </div>
                  <div style="padding: 0.3rem 0; border-bottom: 1px solid rgba(52, 152, 219, 0.2);">
                    <span style="font-size: 0.65rem; color: var(--cor-texto-secundario); margin-bottom: 0.2rem;">Classifica√ß√£o</span>
                    <span style="font-weight: bold; color: var(--cor-primaria); font-size: 0.85rem;" id="burn-class-display">---</span>
                  </div>
                  <div style="padding: 0.3rem 0; border-bottom: 1px solid rgba(52, 152, 219, 0.2);">
                    <span style="font-size: 0.65rem; color: var(--cor-texto-secundario); margin-bottom: 0.2rem;">For√ßa M√©dia</span>
                    <span style="font-weight: bold; color: var(--cor-primaria); font-size: 0.85rem;" id="burn-avg-force-display">---</span>
                  </div>
                  <div style="padding: 0.3rem 0;">
                    <span style="font-size: 0.65rem; color: var(--cor-texto-secundario); margin-bottom: 0.2rem;">For√ßa M√°xima</span>
                    <span style="font-weight: bold; color: var(--cor-primaria); font-size: 0.85rem;" id="burn-max-force-display">---</span>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div style="display: flex; justify-content: space-between; align-items: center; padding: 0 1rem 0.5rem 1rem;">
            <div id="burn-color-toggle" class="toggle-switch">
              <button id="burn-color-class-btn" class="btn btn-toggle active" onclick="setBurnChartColorMode('class')">üé® Cores por Classe</button>
              <button id="burn-color-simple-btn" class="btn btn-toggle" onclick="setBurnChartColorMode('simple')">üíß Cor Simples</button>
            </div>
          </div>
          <div id="burn-analysis-chart" style="width: 98%; height: 400px;"></div>

         
        </div>
      
      </div>
    </div>

  </div>

</body>

</html>
